{"id":"bd-1","title":"Feature: Skill Auto-Activation System with Hooks","design":"## Goal\nAdd comprehensive skill auto-activation system using hooks to ensure skills activate reliably and Claude stays on track during execution.\n\n## Chosen Approach\nModular hook system with three separate hooks (UserPromptSubmit, PostToolUse, Stop) sharing common utilities and skill-rules.json configuration. Shell-based implementation in hooks/ directory at plugin root.\n\n## Success Criteria\n- [ ] All phases complete\n- [ ] skill-rules.json defines rules for all hyperpowers skills\n- [ ] Three hooks implemented and tested\n- [ ] Integration tests passing\n- [ ] Documentation updated\n- [ ] User installation guide created","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-10-30T13:56:46.874868-04:00","updated_at":"2025-10-30T15:44:50.994123-04:00","closed_at":"2025-10-30T15:44:50.994123-04:00"}
{"id":"bd-14c","title":"Create .kimi/ directory structure","description":"Create the Kimi CLI directory structure:\n\n```\n.kimi/\n‚îú‚îÄ‚îÄ skills/           # Will contain SKILL.md files\n‚îú‚îÄ‚îÄ agents/           # Will contain YAML agent files\n‚îú‚îÄ‚îÄ mcp.json          # MCP server configuration (empty initially)\n‚îî‚îÄ‚îÄ hyperpowers.yaml  # Main agent file (created in later task)\n```\n\nAlso create `.agents/skills/` symlink pointing to `.kimi/skills/` for cross-platform compatibility.\n\n## Acceptance Criteria\n- [ ] .kimi/ directory exists\n- [ ] .kimi/skills/ directory exists\n- [ ] .kimi/agents/ directory exists\n- [ ] .kimi/mcp.json exists (can be empty {})\n- [ ] .agents/skills symlink points to ../.kimi/skills","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:27:09.314316735+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T20:33:21.155726291+02:00","closed_at":"2026-02-01T20:33:21.155726291+02:00","close_reason":"Created .kimi/ directory structure with skills/, agents/, mcp.json, and .agents/skills symlink","dependencies":[{"issue_id":"bd-14c","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:14.623296168+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-2","title":"Phase 1: Skill Rules Configuration","design":"## Goal\nCreate skill-rules.json configuration defining triggers for all hyperpowers skills.\n\n## Effort Estimate\n6-8 hours\n\n## Success Criteria\n- [ ] skill-rules.json created with valid JSON (verified with jq . skill-rules.json)\n- [ ] All hyperpowers skills have defined rules (19 skills confirmed)\n- [ ] Each skill has 3-8 keywords and 2-5 intent patterns\n- [ ] Priority levels appropriately assigned (max 3-4 critical skills)\n- [ ] JSON validates successfully with jq\n- [ ] No regex patterns fail catastrophic backtracking test\n- [ ] Sample prompts match expected skills (90%+ accuracy on test set)\n- [ ] File size under 50KB\n- [ ] Documentation comments explain each pattern's purpose\n\n## Implementation Steps (ADDED BY writing-plans)\n\n### Step Group 1: Initial Setup and Skill Inventory\n\n**Files:**\n- Create: hooks/skill-rules.json\n- Reference: skills/skills-auto-activation/resources/skill-rules-examples.md\n\n**Step 1: Count and list all skills**\n\nRun:\n```bash\ncd /Users/ryan/src/hyper\nls -1 skills/*/SKILL.md | wc -l\n```\nExpected: 19 skills\n\n**Step 2: Extract all skill names for reference**\n\nRun:\n```bash\ncd /Users/ryan/src/hyper\nfor skill in skills/*/SKILL.md; do \n  dirname \"$skill\" | sed 's|skills/||'\ndone | sort\n```\nExpected output: List of 19 skills (brainstorming through writing-skills)\n\n### Step Group 2: Create Core Configuration Structure\n\n**Step 3: Create initial skill-rules.json with schema documentation**\n\nCreate hooks/skill-rules.json:\n```json\n{\n  \"_comment\": \"Skill activation rules for hyperpowers plugin - 19 skills total\",\n  \"_schema\": {\n    \"description\": \"Each skill has type, enforcement, priority, and triggers\",\n    \"type\": \"process|domain|workflow\", \n    \"enforcement\": \"suggest\",\n    \"priority\": \"critical|high|medium|low\",\n    \"promptTriggers\": {\n      \"keywords\": \"Array of case-insensitive strings\",\n      \"intentPatterns\": \"Array of regex patterns for action+object\"\n    }\n  }\n}\n```\n\n**Step 4: Verify JSON syntax**\n\nRun:\n```bash\ncd /Users/ryan/src/hyper\njq . hooks/skill-rules.json\n```\nExpected: Valid JSON output with formatted structure\n\n### Step Group 3: Add Core Workflow Skills (5 skills)\n\n**Step 5: Add test-driven-development skill rules**\n\nAdd to hooks/skill-rules.json:\n```json\n\"test-driven-development\": {\n  \"type\": \"process\",\n  \"enforcement\": \"suggest\",\n  \"priority\": \"critical\",\n  \"promptTriggers\": {\n    \"keywords\": [\"test\", \"testing\", \"TDD\", \"spec\", \"unit test\", \"integration test\", \"test first\", \"red green refactor\"],\n    \"intentPatterns\": [\n      \"(write|add|create|implement).*?(test|spec|unit test)\",\n      \"test.*(first|before|driven)\",\n      \"(implement|build|create).*?(feature|function|component)\",\n      \"red.*(green|refactor)\",\n      \"(bug|fix|issue).*?reproduce\"\n    ]\n  }\n}\n```\n\n**Step 6: Add debugging-with-tools skill rules**\n\nAdd to hooks/skill-rules.json:\n```json\n\"debugging-with-tools\": {\n  \"type\": \"process\",\n  \"enforcement\": \"suggest\",\n  \"priority\": \"high\",\n  \"promptTriggers\": {\n    \"keywords\": [\"debug\", \"debugging\", \"error\", \"bug\", \"crash\", \"fails\", \"broken\", \"not working\", \"issue\"],\n    \"intentPatterns\": [\n      \"(debug|fix|solve|investigate|troubleshoot).*?(error|bug|issue|problem)\",\n      \"(why|what).*?(failing|broken|not working|crashing)\",\n      \"(find|locate|identify).*?(bug|issue|problem|root cause)\",\n      \"reproduce.*(bug|issue|error)\",\n      \"stack.*(trace|error)\"\n    ]\n  }\n}\n```\n\n**Step 7: Add refactoring-safely skill rules**\n\nAdd to hooks/skill-rules.json:\n```json\n\"refactoring-safely\": {\n  \"type\": \"process\",\n  \"enforcement\": \"suggest\",\n  \"priority\": \"medium\",\n  \"promptTriggers\": {\n    \"keywords\": [\"refactor\", \"refactoring\", \"cleanup\", \"improve\", \"restructure\", \"reorganize\", \"simplify\"],\n    \"intentPatterns\": [\n      \"(refactor|clean up|improve|restructure).*?(code|function|class|component)\",\n      \"(extract|split|separate).*?(function|method|component|logic)\",\n      \"(rename|move|relocate).*?(file|function|class)\",\n      \"remove.*(duplication|duplicate|repeated code)\"\n    ]\n  }\n}\n```\n\n**Step 8: Add fixing-bugs skill rules**\n\nAdd to hooks/skill-rules.json:\n```json\n\"fixing-bugs\": {\n  \"type\": \"process\",\n  \"enforcement\": \"suggest\",\n  \"priority\": \"high\",\n  \"promptTriggers\": {\n    \"keywords\": [\"bug\", \"fix\", \"issue\", \"problem\", \"defect\", \"regression\"],\n    \"intentPatterns\": [\n      \"(fix|resolve|solve).*?(bug|issue|problem|defect)\",\n      \"(bug|issue|problem).*(report|ticket|found)\",\n      \"regression.*(test|fix|found)\",\n      \"(broken|not working).*(fix|repair)\"\n    ]\n  }\n}\n```\n\n**Step 9: Add root-cause-tracing skill rules**\n\nAdd to hooks/skill-rules.json:\n```json\n\"root-cause-tracing\": {\n  \"type\": \"process\",\n  \"enforcement\": \"suggest\",\n  \"priority\": \"medium\",\n  \"promptTriggers\": {\n    \"keywords\": [\"root cause\", \"trace\", \"origin\", \"source\", \"why\", \"deep dive\"],\n    \"intentPatterns\": [\n      \"root.*(cause|problem|issue)\",\n      \"trace.*(back|origin|source)\",\n      \"(why|how).*(happening|occurring|caused)\",\n      \"deep.*(dive|analysis|investigation)\"\n    ]\n  }\n}\n```\n\n### Step Group 4: Add Planning \u0026 Execution Skills (8 skills)\n\n**Step 10: Add brainstorming skill rules**\n\nAdd to hooks/skill-rules.json:\n```json\n\"brainstorming\": {\n  \"type\": \"workflow\",\n  \"enforcement\": \"suggest\",\n  \"priority\": \"high\",\n  \"promptTriggers\": {\n    \"keywords\": [\"plan\", \"design\", \"architecture\", \"approach\", \"brainstorm\", \"idea\", \"feature\", \"implement\"],\n    \"intentPatterns\": [\n      \"(create|build|add|implement).*?(feature|system|component|functionality)\",\n      \"(how should|what's the best way|how to).*?(implement|build|design)\",\n      \"I want to.*(add|create|build|implement)\",\n      \"(plan|design|architect).*?(system|feature|component)\",\n      \"let's.*(think|plan|design)\"\n    ]\n  }\n}\n```\n\n**Step 11: Add writing-plans skill rules**\n\nAdd to hooks/skill-rules.json:\n```json\n\"writing-plans\": {\n  \"type\": \"workflow\",\n  \"enforcement\": \"suggest\",\n  \"priority\": \"high\",\n  \"promptTriggers\": {\n    \"keywords\": [\"expand\", \"enhance\", \"detailed steps\", \"implementation steps\", \"bd tasks\"],\n    \"intentPatterns\": [\n      \"expand.*?(bd|task|plan)\",\n      \"enhance.*?with.*(steps|details)\",\n      \"add.*(implementation|detailed).*(steps|instructions)\",\n      \"write.*?plan\"\n    ]\n  }\n}\n```\n\n**Step 12: Add executing-plans skill rules**\n\nAdd to hooks/skill-rules.json:\n```json\n\"executing-plans\": {\n  \"type\": \"workflow\",\n  \"enforcement\": \"suggest\",\n  \"priority\": \"high\",\n  \"promptTriggers\": {\n    \"keywords\": [\"execute\", \"implement\", \"start working\", \"begin implementation\", \"work on bd\"],\n    \"intentPatterns\": [\n      \"execute.*(plan|tasks|bd)\",\n      \"(start|begin).*(implementation|work|executing)\",\n      \"implement.*?bd-\\\\d+\",\n      \"work.*?on.*(tasks|bd|plan)\"\n    ]\n  }\n}\n```\n\n**Step 13: Add remaining planning skills**\n\nAdd review-implementation, finishing-a-development-branch, sre-task-refinement, managing-bd-tasks with similar patterns.\n\n### Step Group 5: Add Quality \u0026 Infrastructure Skills (6 skills)\n\n**Step 14: Add verification-before-completion skill rules**\n\nAdd to hooks/skill-rules.json:\n```json\n\"verification-before-completion\": {\n  \"type\": \"process\",\n  \"enforcement\": \"suggest\",\n  \"priority\": \"critical\",\n  \"promptTriggers\": {\n    \"keywords\": [\"done\", \"complete\", \"finished\", \"ready\", \"verified\", \"works\", \"passing\"],\n    \"intentPatterns\": [\n      \"(I'm|it's|work is).*(done|complete|finished)\",\n      \"(ready|prepared).*(merge|commit|push|PR)\",\n      \"everything.*(works|passes|ready)\",\n      \"(verified|tested|checked).*?(everything|all)\",\n      \"can we.*(merge|commit|ship)\"\n    ]\n  }\n}\n```\n\n**Step 15: Add remaining quality and infrastructure skills**\n\nAdd dispatching-parallel-agents, building-hooks, skills-auto-activation, testing-anti-patterns, using-hyper, writing-skills with appropriate patterns.\n\n### Step Group 6: Test and Validate Configuration\n\n**Step 16: Validate complete JSON file**\n\nRun:\n```bash\ncd /Users/ryan/src/hyper\njq . hooks/skill-rules.json \u003e /dev/null \u0026\u0026 echo \"‚úì Valid JSON\" || echo \"‚úó Invalid JSON\"\n```\nExpected: ‚úì Valid JSON\n\n**Step 17: Check file size**\n\nRun:\n```bash\nls -lh hooks/skill-rules.json | awk '{print $5}'\n```\nExpected: \u003c 50KB (should be around 15-20KB)\n\n**Step 18: Count skills in configuration**\n\nRun:\n```bash\njq 'keys - [\"_comment\", \"_schema\"] | length' hooks/skill-rules.json\n```\nExpected: 19\n\n**Step 19: Test keyword matching with sample prompts**\n\nCreate test script:\n```bash\n#!/bin/bash\n# Test skill activation patterns\nprompt=\"I want to write a test for the login function\"\njq --arg prompt \"$prompt\" '\n  to_entries | \n  map(select(.value.promptTriggers.keywords as $kw | \n    $prompt | ascii_downcase | \n    test($kw | map(. | ascii_downcase) | join(\"|\"))\n  )) | \n  map(.key)\n' hooks/skill-rules.json\n```\nExpected: Should match \"test-driven-development\"\n\n**Step 20: Commit the configuration**\n\nRun:\n```bash\ngit add hooks/skill-rules.json\ngit commit -m \"feat(bd-2): create skill-rules.json configuration\n\nImplements bd-2: Skill Rules Configuration\n- Defines activation rules for all 19 hyperpowers skills\n- Includes keywords and intent patterns for each skill\n- Sets appropriate priority levels (critical/high/medium/low)\n- Validated JSON syntax and file size \u003c 50KB\"\n```\n\n### Step Group 7: Document Pattern Testing\n\n**Step 21: Create regex testing documentation**\n\nCreate hooks/REGEX_TESTING.md:\n```markdown\n# Regex Pattern Testing for skill-rules.json\n\n## Tested Patterns\n\nAll regex patterns in skill-rules.json have been tested on regex101.com for:\n- Catastrophic backtracking (10000 'a's input)\n- Unicode handling\n- Performance\n\n### Test Results\n\n| Pattern | Backtracking Safe | Unicode Safe | Avg Time |\n|---------|------------------|--------------|----------|\n| (create|add).*?(feature|component) | ‚úì | ‚úì | \u003c1ms |\n| (debug|fix).*?(error|bug) | ‚úì | ‚úì | \u003c1ms |\n[... document all patterns ...]\n```\n\n**Step 22: Final validation**\n\nRun:\n```bash\ncd /Users/ryan/src/hyper\necho \"=== Skill Rules Validation ===\"\necho \"1. JSON valid: $(jq . hooks/skill-rules.json \u003e /dev/null 2\u003e\u00261 \u0026\u0026 echo '‚úì' || echo '‚úó')\"\necho \"2. Skill count: $(jq 'keys - [\"_comment\", \"_schema\"] | length' hooks/skill-rules.json) (expected: 19)\"\necho \"3. File size: $(ls -lh hooks/skill-rules.json | awk '{print $5}')\"\n```\nExpected: All validations pass\n\n## Key Considerations (ADDED BY SRE REVIEW)\n- Pattern Design: Intent patterns should be broad enough to catch variations but specific enough to avoid false positives\n- Priority Balance: Don't overuse \"critical\" - reserve for verification and safety-critical workflows\n- Regex Performance: Keep patterns simple; avoid catastrophic backtracking\n- Maintenance: Document reasoning for each pattern to help future updates\n- File Size: Large JSON files can slow parsing - keep under 50KB\n- Testing Regex: MUST test all patterns on regex101.com with pathological inputs (10000 'a's)\n- Unicode Handling: Patterns should handle Unicode input gracefully\n- Case Sensitivity: All matching must be case-insensitive\n\n## Anti-patterns to Avoid\n- ‚ùå Overly broad keywords that match too many prompts (e.g., \"code\", \"file\", \"data\")\n- ‚ùå Complex regex patterns that are hard to maintain or have backtracking issues\n- ‚ùå Marking too many skills as \"critical\" priority (dilutes importance)\n- ‚ùå Missing common variations in intent patterns\n- ‚ùå Untested regex patterns (MUST test on regex101.com)\n- ‚ùå No comments explaining pattern intent\n- ‚ùå File size over 50KB (performance impact)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-30T13:56:54.618233-04:00","updated_at":"2025-10-30T14:56:49.100685-04:00","closed_at":"2025-10-30T14:56:49.100685-04:00","dependencies":[{"issue_id":"bd-2","depends_on_id":"bd-1","type":"parent-child","created_at":"2025-10-30T13:57:10.44578-04:00","created_by":"ryan"}]}
{"id":"bd-3","title":"Phase 2: Shared Utility Functions","design":"## Goal\nBuild shared utility functions for skill matching and output formatting.\n\n## Effort Estimate  \n6-8 hours\n\n## Success Criteria\n- [ ] Both utility scripts created\n- [ ] Dependency checks implemented and tested\n- [ ] All functions implemented with proper error handling\n- [ ] Scripts fail gracefully if jq not installed (exit 1, clear error message)\n- [ ] Functions can be tested independently\n- [ ] All functions properly documented with comments\n- [ ] Handle empty/null inputs gracefully (return appropriate error code)\n- [ ] Handle malformed JSON gracefully (error message, exit 1)\n- [ ] Handle very long inputs (\u003e10KB) without hanging\n- [ ] Performance: match_keywords completes in \u003c50ms for typical input\n- [ ] Performance: find_matching_skills completes in \u003c200ms for 20 skills\n\n## Implementation Steps (ADDED BY writing-plans)\n\n### Step Group 1: Create Directory Structure\n\n**Files:**\n- Create: hooks/utils/skill-matcher.sh\n- Create: hooks/utils/format-output.sh\n\n**Step 1: Verify utils directory**\nRun:\n```bash\ncd /Users/ryan/src/hyper\nls -la hooks/utils/\n```\nExpected: Directory exists and is writable\n\n### Step Group 2: Create skill-matcher.sh Core Structure\n\n**Step 2: Create skill-matcher.sh with dependency checking**\nCreate hooks/utils/skill-matcher.sh:\n```bash\n#!/usr/bin/env bash\nset -e\n\ncheck_dependencies() {\n  local missing=()\n  command -v jq \u003e/dev/null 2\u003e\u00261 || missing+=(\"jq\")\n  command -v grep \u003e/dev/null 2\u003e\u00261 || missing+=(\"grep\")\n  \n  if [ ${#missing[@]} -gt 0 ]; then\n    echo \"ERROR: Missing required dependencies: ${missing[*]}\" \u003e\u00262\n    echo \"Please install missing tools and try again.\" \u003e\u00262\n    return 1\n  fi\n  return 0\n}\n\ncheck_dependencies || exit 1\n```\n\n**Step 3: Make executable**\nRun: `chmod +x hooks/utils/skill-matcher.sh`\n\n**Step 4: Test dependency checking**\nRun: `source hooks/utils/skill-matcher.sh \u0026\u0026 echo \"OK: $?\"`\nExpected: \"OK: 0\"\n\n### Step Group 3: Implement Skill Matcher Functions\n\n**Step 5: Add load_skill_rules function**\nAdd to skill-matcher.sh:\n```bash\nload_skill_rules() {\n  local rules_path=\"$1\"\n  \n  if [ -z \"$rules_path\" ]; then\n    echo \"ERROR: No rules path provided\" \u003e\u00262\n    return 1\n  fi\n  \n  if [ ! -f \"$rules_path\" ]; then\n    echo \"ERROR: Rules file not found: $rules_path\" \u003e\u00262\n    return 1\n  fi\n  \n  if ! jq . \"$rules_path\" 2\u003e/dev/null; then\n    echo \"ERROR: Invalid JSON in $rules_path\" \u003e\u00262\n    return 1\n  fi\n  \n  return 0\n}\n```\n\n**Step 6: Add match_keywords function**\nAdd to skill-matcher.sh:\n```bash\nmatch_keywords() {\n  local text=\"$1\"\n  local keywords=\"$2\"\n  \n  if [ -z \"$text\" ] || [ -z \"$keywords\" ]; then\n    return 1\n  fi\n  \n  local lower_text=$(echo \"$text\" | tr '[:upper:]' '[:lower:]')\n  \n  IFS=',' read -ra KEYWORD_ARRAY \u003c\u003c\u003c \"$keywords\"\n  for keyword in \"${KEYWORD_ARRAY[@]}\"; do\n    local lower_keyword=$(echo \"$keyword\" | tr '[:upper:]' '[:lower:]' | xargs)\n    if [[ \"$lower_text\" == *\"$lower_keyword\"* ]]; then\n      return 0\n    fi\n  done\n  \n  return 1\n}\n```\n\n**Step 7: Add match_patterns function**\nAdd to skill-matcher.sh:\n```bash\nmatch_patterns() {\n  local text=\"$1\"\n  local patterns=\"$2\"\n  \n  if [ -z \"$text\" ] || [ -z \"$patterns\" ]; then\n    return 1\n  fi\n  \n  local timeout_cmd=\"\"\n  if command -v timeout \u003e/dev/null 2\u003e\u00261; then\n    timeout_cmd=\"timeout 1\"\n  fi\n  \n  IFS=',' read -ra PATTERN_ARRAY \u003c\u003c\u003c \"$patterns\"\n  for pattern in \"${PATTERN_ARRAY[@]}\"; do\n    pattern=$(echo \"$pattern\" | xargs)\n    \n    if $timeout_cmd grep -Ei \"$pattern\" \u003c\u003c\u003c \"$text\" \u003e/dev/null 2\u003e\u00261; then\n      return 0\n    fi\n  done\n  \n  return 1\n}\n```\n\n**Step 8: Add find_matching_skills function**\nAdd complete function to match skills based on prompts, sorting by priority and limiting to top 3.\n\n**Step 9: Test functions**\nRun:\n```bash\nsource hooks/utils/skill-matcher.sh\nmatch_keywords \"I want to write a test\" \"test,testing,TDD\" \u0026\u0026 echo \"‚úì Works\"\nmatch_patterns \"create a new feature\" \"(create|add).*?(feature|component)\" \u0026\u0026 echo \"‚úì Works\"\nmatch_keywords \"\" \"test\" || echo \"‚úì Empty handled\"\n```\nExpected: All pass\n\n### Step Group 4: Create format-output.sh\n\n**Step 10: Create format-output.sh with dependency checking**\nCreate hooks/utils/format-output.sh:\n```bash\n#!/usr/bin/env bash\nset -e\n\ncheck_dependencies() {\n  local missing=()\n  command -v jq \u003e/dev/null 2\u003e\u00261 || missing+=(\"jq\")\n  \n  if [ ${#missing[@]} -gt 0 ]; then\n    echo \"ERROR: Missing required dependencies: ${missing[*]}\" \u003e\u00262\n    return 1\n  fi\n  return 0\n}\n\ncheck_dependencies || exit 1\n\nget_priority_emoji() {\n  local priority=\"$1\"\n  case \"$priority\" in\n    \"critical\") echo \"üî¥\" ;;\n    \"high\") echo \"‚≠ê\" ;;\n    \"medium\") echo \"üìå\" ;;\n    \"low\") echo \"üí°\" ;;\n    *) echo \"‚Ä¢\" ;;\n  esac\n}\n```\n\n**Step 11: Add format_skill_reminder function**\nAdd function to format matched skills into activation reminder text.\n\n**Step 12: Add format_gentle_reminder function**\nAdd function for TDD, testing, and verification reminders.\n\n**Step 13: Make executable**\nRun: `chmod +x hooks/utils/format-output.sh`\n\n**Step 14: Test functions**\nRun:\n```bash\nsource hooks/utils/format-output.sh\n[ \"$(get_priority_emoji critical)\" = \"üî¥\" ] \u0026\u0026 echo \"‚úì Emoji works\"\nformat_gentle_reminder \"tdd\" | grep \"RED-GREEN-REFACTOR\" \u0026\u0026 echo \"‚úì Reminder works\"\n```\n\n### Step Group 5: Performance Testing\n\n**Step 15: Create performance test**\nCreate hooks/utils/test-performance.sh to test match_keywords \u003c50ms and find_matching_skills \u003c200ms.\n\n**Step 16: Run performance tests**\nRun: `bash hooks/utils/test-performance.sh`\nExpected: Both under targets\n\n### Step Group 6: Validation and Testing\n\n**Step 17: Test edge cases**\nTest with empty inputs, malformed JSON, very long inputs (\u003e10KB).\n\n**Step 18: Commit utilities**\nRun:\n```bash\ngit add hooks/utils/skill-matcher.sh hooks/utils/format-output.sh\ngit commit -m \"feat(bd-3): create shared utility functions\n\nImplements bd-3: Shared Utility Functions\n- skill-matcher.sh with keyword/pattern matching\n- format-output.sh with formatting functions\n- Dependency checking for jq and grep\n- Performance optimized\n- Edge case handling\"\n```\n\n**Step 19-20: Create and run test suite**\nCreate comprehensive test suite and verify all tests pass.\n\n## Key Considerations (ADDED BY SRE REVIEW)\n- Dependency Failures: Scripts must fail immediately if jq not found\n- Error Messages: Clear, actionable error messages for missing deps\n- Pure Functions: No side effects, easy to test independently\n- JSON I/O: Use jq for all JSON operations\n- Error Handling: Functions return error codes, caller decides handling\n- Modularity: Each function does one thing well\n- Regex Timeout: Long regex can hang - consider GNU timeout wrapper if available\n- Input Validation: Check for empty/null inputs before processing\n- Output Escaping: Properly escape special characters in formatted output\n- Performance: Cache compiled regex patterns if possible\n- Large Input Handling: Gracefully handle prompts \u003e10KB\n\n## Anti-patterns to Avoid\n- ‚ùå Assuming dependencies are installed without checking\n- ‚ùå Silent failures when dependencies missing\n- ‚ùå Functions with side effects (writing files, modifying globals)\n- ‚ùå Complex regex that's hard to debug or has catastrophic backtracking\n- ‚ùå Hardcoded paths instead of using parameters\n- ‚ùå No input validation (empty strings, null values)\n- ‚ùå No timeout protection for regex operations\n- ‚ùå Unbounded memory usage for large inputs","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-30T13:57:03.276093-04:00","updated_at":"2025-10-30T15:00:23.673747-04:00","closed_at":"2025-10-30T15:00:23.673747-04:00","dependencies":[{"issue_id":"bd-3","depends_on_id":"bd-1","type":"parent-child","created_at":"2025-10-30T13:57:10.461298-04:00","created_by":"ryan"},{"issue_id":"bd-3","depends_on_id":"bd-2","type":"blocks","created_at":"2025-10-30T13:57:16.81907-04:00","created_by":"ryan"}]}
{"id":"bd-3yf","title":"Epic: Cass Memory Integration","design":"## Requirements (IMMUTABLE)\n- Every agent invocation (top-level prompt + Task subagents) injects cass memory context.\n- Cass memory is the only memory source (no Supermemory merge).\n- Context is generated via `cm context \"\u003cprompt\u003e\" --json` and formatted into a deterministic block with rule IDs.\n- Integration is non-blocking: missing/failed/timeout `cm` calls proceed without memory and log errors.\n- Configurable limits exist for rule count/size and timeout.\n\n## Success Criteria (MUST ALL BE TRUE)\n- [ ] OpenCode plugin injects cass context for Task tool calls.\n- [ ] Claude Code hook injects cass context for top-level prompts.\n- [ ] Memory block format is deterministic and size-limited.\n- [ ] Missing/timeout `cm` calls log errors and do not block.\n- [ ] All tests passing\n- [ ] Pre-commit hooks passing\n\n## Anti-Patterns (FORBIDDEN)\n- ‚ùå NO Supermemory merge (scope: cass-only per user request)\n- ‚ùå NO hard-fail when `cm` is missing (reliability: must degrade gracefully)\n- ‚ùå NO injection into non-agent tools (scope: keep to Task/top-level prompts)\n- ‚ùå NO unbounded memory payloads (prompt safety: cap size)\n\n## Approach\nImplement a hybrid integration: an OpenCode plugin intercepts `tool.execute.before` for `task` calls, runs `cm context` with the task prompt, and prepends a compact memory block to the agent prompt. A Claude Code `user-prompt-submit` hook runs the same `cm context` against the top-level user prompt and returns `additionalContext`. Both paths share the same formatting and limits, log failures, and default to no-op on errors.\n\n## Architecture\n- `.opencode/plugins/cass-memory.ts` - OpenCode plugin for Task tool injection\n- `.opencode/cass-memory.json` - config (limits/timeout)\n- `.opencode/cache/cass/*` - logs and last context\n- `hooks/user-prompt-submit/20-cass-context.js` - top-level prompt injection\n- `hooks/context/cass-context.json` - last top-level context\n\n## Design Rationale\n### Problem\nHyperpowers needs procedural memory applied automatically on every agent call to improve consistency and avoid repeating mistakes.\n\n### Research Findings\n**Codebase:**\n- `.opencode/plugins/hyperpowers-skills.ts` - plugin registration and tool hook pattern\n- `.opencode/plugins/hyperpowers-safety.ts` - `tool.execute.before` interception\n- `hooks/user-prompt-submit/10-skill-activator.js` - prompt augmentation via `additionalContext`\n\n**External:**\n- cass memory system: `cm context \"\u003ctask\u003e\" --json` is the primary integration surface\n- `cm serve --port ...` provides an MCP server option if needed later\n\n### Approaches Considered\n1. **Hybrid plugin + hook** ‚úì\n   - Pros: covers top-level prompts and Task subagents; no background service\n   - Cons: two codepaths to maintain\n   - **Chosen because:** matches existing OpenCode + hook architecture and satisfies ‚Äúevery agent call‚Äù\n\n2. **MCP server integration**\n   - Pros: persistent server, lower latency\n   - Cons: requires daemon, port management\n   - **Rejected because:** unnecessary operational overhead for current scope\n\n3. **Hooks-only**\n   - Pros: simple to implement\n   - Cons: does not reliably cover Task subagents\n   - **Rejected because:** misses the ‚Äúevery agent call‚Äù requirement\n\n### Scope Boundaries\n**In scope:**\n- Task tool and top-level prompt injection\n- Configurable limits and logging\n- Optional status command\n\n**Out of scope (deferred/never):**\n- Supermemory merge\n- Auto-installing cm\n- Running `cm reflect` or playbook edits\n\n### Open Questions\n- Final config location: `.opencode/cass-memory.json` vs `opencode.json` plugin section\n- Whether to ship a `/cass-status` command in the first iteration","status":"closed","priority":2,"issue_type":"epic","owner":"dmitry.polishuk@gmail.com","created_at":"2026-01-21T23:11:03.61869+03:00","created_by":"Dmitry Polishuk","updated_at":"2026-01-22T12:04:33.760389+03:00","closed_at":"2026-01-22T12:04:33.760389+03:00","close_reason":"Closed"}
{"id":"bd-4","title":"Phase 3: UserPromptSubmit Hook (Skill Activator)","design":"## Goal\nImplement hook that analyzes prompts and injects skill activation reminders.\n\n## Effort Estimate\n6-8 hours\n\n## Success Criteria\n- [ ] UserPromptSubmit hook created and configured in hooks.json\n- [ ] Hook analyzes prompts using skill-rules.json patterns\n- [ ] Top 3 matching skills injected as additionalContext\n- [ ] Priority-based sorting (critical \u003e high \u003e medium \u003e low)\n- [ ] Hook handles errors gracefully (always returns decision: continue)\n- [ ] Performance: \u003c100ms for typical prompt analysis\n- [ ] Manual testing with 5 sample prompts shows correct skill activation\n- [ ] Hook doesn't block or crash on malformed input\n\n## Implementation Steps (ADDED BY writing-plans)\n\n### Step Group 1: Create Hook Directory and Script\n\n**Files:**\n- Create: hooks/user-prompt-submit/10-skill-activator.js\n- Modify: hooks/hooks.json\n\n**Step 1: Create user-prompt-submit directory**\n\nRun:\n\\`\\`\\`bash\nmkdir -p hooks/user-prompt-submit\n\\`\\`\\`\n\n**Step 2: Create the skill-activator hook script**\n\nCreate \\`hooks/user-prompt-submit/10-skill-activator.js\\`:\n\n\\`\\`\\`javascript\n#!/usr/bin/env node\n\nconst fs = require('fs');\nconst path = require('path');\n\n// Configuration\nconst CONFIG = {\n    rulesPath: path.join(__dirname, '..', 'skill-rules.json'),\n    maxSkills: 3,  // Limit to top 3 to avoid context overload\n    debugMode: process.env.DEBUG_HOOKS === 'true'\n};\n\n// Load skill rules from skill-rules.json\nfunction loadRules() {\n    try {\n        const content = fs.readFileSync(CONFIG.rulesPath, 'utf8');\n        const data = JSON.parse(content);\n        // Filter out _comment and _schema meta keys\n        const rules = {};\n        for (const [key, value] of Object.entries(data)) {\n            if (!key.startsWith('_')) {\n                rules[key] = value;\n            }\n        }\n        return rules;\n    } catch (error) {\n        if (CONFIG.debugMode) {\n            console.error('Failed to load skill rules:', error.message);\n        }\n        return {};\n    }\n}\n\n// Read prompt from stdin (Claude passes { \"text\": \"...\" })\nfunction readPrompt() {\n    return new Promise((resolve) =\u003e {\n        let data = '';\n        process.stdin.on('data', chunk =\u003e data += chunk);\n        process.stdin.on('end', () =\u003e {\n            try {\n                resolve(JSON.parse(data));\n            } catch (error) {\n                if (CONFIG.debugMode) {\n                    console.error('Failed to parse prompt:', error.message);\n                }\n                resolve({ text: '' });\n            }\n        });\n    });\n}\n\n// Analyze prompt for skill matches\nfunction analyzePrompt(promptText, rules) {\n    const lowerText = promptText.toLowerCase();\n    const activated = [];\n\n    for (const [skillName, config] of Object.entries(rules)) {\n        let matched = false;\n        let matchReason = '';\n\n        // Check keyword triggers (case-insensitive substring matching)\n        if (config.promptTriggers?.keywords) {\n            for (const keyword of config.promptTriggers.keywords) {\n                if (lowerText.includes(keyword.toLowerCase())) {\n                    matched = true;\n                    matchReason = \\`keyword: \"\\${keyword}\"\\`;\n                    break;\n                }\n            }\n        }\n\n        // Check intent pattern triggers (regex matching)\n        if (!matched \u0026\u0026 config.promptTriggers?.intentPatterns) {\n            for (const pattern of config.promptTriggers.intentPatterns) {\n                try {\n                    if (new RegExp(pattern, 'i').test(promptText)) {\n                        matched = true;\n                        matchReason = \\`intent pattern: \"\\${pattern}\"\\`;\n                        break;\n                    }\n                } catch (error) {\n                    if (CONFIG.debugMode) {\n                        console.error(\\`Invalid pattern \"\\${pattern}\":\\`, error.message);\n                    }\n                }\n            }\n        }\n\n        if (matched) {\n            activated.push({\n                skill: skillName,\n                priority: config.priority || 'medium',\n                reason: matchReason,\n                type: config.type || 'workflow'\n            });\n        }\n    }\n\n    // Sort by priority (critical \u003e high \u003e medium \u003e low)\n    const priorityOrder = { critical: 0, high: 1, medium: 2, low: 3 };\n    activated.sort((a, b) =\u003e {\n        const priorityDiff = priorityOrder[a.priority] - priorityOrder[b.priority];\n        if (priorityDiff !== 0) return priorityDiff;\n        // Secondary sort: process types before domain/workflow types\n        const typeOrder = { process: 0, domain: 1, workflow: 2 };\n        return (typeOrder[a.type] || 2) - (typeOrder[b.type] || 2);\n    });\n\n    // Limit to max skills\n    return activated.slice(0, CONFIG.maxSkills);\n}\n\n// Generate activation context message\nfunction generateContext(skills) {\n    if (skills.length === 0) {\n        return null;\n    }\n\n    const lines = [\n        '',\n        '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',\n        'üéØ SKILL ACTIVATION CHECK',\n        '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',\n        '',\n        'Relevant skills for this prompt:',\n        ''\n    ];\n\n    for (const skill of skills) {\n        const emoji = skill.priority === 'critical' ? 'üî¥' : \n                     skill.priority === 'high' ? '‚≠ê' : \n                     skill.priority === 'medium' ? 'üìå' : 'üí°';\n        lines.push(\\`\\${emoji} **\\${skill.skill}** (\\${skill.priority} priority, \\${skill.type})\\`);\n\n        if (CONFIG.debugMode) {\n            lines.push(\\`   Matched: \\${skill.reason}\\`);\n        }\n    }\n\n    lines.push('');\n    lines.push('Before responding, check if any of these skills should be used.');\n    lines.push('Use the Skill tool to activate: \\`Skill command=\"hyperpowers:\u003cskill-name\u003e\"\\`');\n    lines.push('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n    lines.push('');\n\n    return lines.join('\\\\n');\n}\n\n// Main execution\nasync function main() {\n    try {\n        // Load rules\n        const rules = loadRules();\n\n        if (Object.keys(rules).length === 0) {\n            if (CONFIG.debugMode) {\n                console.error('No rules loaded');\n            }\n            console.log(JSON.stringify({ decision: 'continue' }));\n            return;\n        }\n\n        // Read prompt\n        const prompt = await readPrompt();\n\n        if (!prompt.text || prompt.text.trim() === '') {\n            console.log(JSON.stringify({ decision: 'continue' }));\n            return;\n        }\n\n        // Analyze prompt\n        const activatedSkills = analyzePrompt(prompt.text, rules);\n\n        // Generate response\n        if (activatedSkills.length \u003e 0) {\n            const context = generateContext(activatedSkills);\n\n            if (CONFIG.debugMode) {\n                console.error('Activated skills:', activatedSkills.map(s =\u003e s.skill).join(', '));\n            }\n\n            console.log(JSON.stringify({\n                decision: 'continue',\n                additionalContext: context\n            }));\n        } else {\n            if (CONFIG.debugMode) {\n                console.error('No skills activated');\n            }\n            console.log(JSON.stringify({ decision: 'continue' }));\n        }\n    } catch (error) {\n        if (CONFIG.debugMode) {\n            console.error('Hook error:', error.message, error.stack);\n        }\n        // Always continue on error - never block user\n        console.log(JSON.stringify({ decision: 'continue' }));\n    }\n}\n\nmain();\n\\`\\`\\`\n\n**Step 3: Make the script executable**\n\nRun:\n\\`\\`\\`bash\nchmod +x hooks/user-prompt-submit/10-skill-activator.js\n\\`\\`\\`\n\n### Step Group 2: Configure Hook in hooks.json\n\n**Files:**\n- Modify: hooks/hooks.json\n\n**Step 4: Read current hooks.json**\n\nRun:\n\\`\\`\\`bash\ncat hooks/hooks.json\n\\`\\`\\`\n\nExpected output shows current hooks (SessionStart, PreToolUse)\n\n**Step 5: Add UserPromptSubmit configuration**\n\nRead the current hooks.json, then update it to add the UserPromptSubmit hook. The complete hooks.json should look like:\n\n\\`\\`\\`json\n{\n  \"hooks\": {\n    \"SessionStart\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"\\${CLAUDE_PLUGIN_ROOT}/hooks/session-start.sh\"\n          }\n        ]\n      }\n    ],\n    \"PreToolUse\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"\\${CLAUDE_PLUGIN_ROOT}/hooks/block-beads-direct-read.py\"\n          }\n        ]\n      }\n    ],\n    \"UserPromptSubmit\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"\\${CLAUDE_PLUGIN_ROOT}/hooks/user-prompt-submit/10-skill-activator.js\"\n          }\n        ]\n      }\n    ]\n  }\n}\n\\`\\`\\`\n\n**Step 6: Validate hooks.json syntax**\n\nRun:\n\\`\\`\\`bash\njq . hooks/hooks.json \u003e /dev/null \u0026\u0026 echo \"‚úì Valid JSON\" || echo \"‚úó Invalid JSON\"\n\\`\\`\\`\n\nExpected: \"‚úì Valid JSON\"\n\n### Step Group 3: Manual Testing\n\n**Files:**\n- Test: hooks/user-prompt-submit/10-skill-activator.js\n\n**Step 7: Create test script**\n\nCreate \\`hooks/user-prompt-submit/test-hook.sh\\`:\n\n\\`\\`\\`bash\n#!/bin/bash\nset -e\n\necho \"=== Testing Skill Activator Hook ===\"\necho \"\"\n\ntest_prompt() {\n    local prompt=\"\\$1\"\n    local expected_skills=\"\\$2\"\n    \n    echo \"Test: \\$prompt\"\n    result=\\$(echo \"{\\\\\"text\\\\\": \\\\\"\\$prompt\\\\\"}\" | node hooks/user-prompt-submit/10-skill-activator.js)\n    \n    if echo \"\\$result\" | jq -e '.decision == \"continue\"' \u003e /dev/null; then\n        echo \"‚úì Returns continue decision\"\n    else\n        echo \"‚úó FAIL: Wrong decision\"\n        return 1\n    fi\n    \n    if echo \"\\$result\" | jq -e '.additionalContext' \u003e /dev/null 2\u003e\u00261; then\n        activated=\\$(echo \"\\$result\" | jq -r '.additionalContext' | grep -oP '\\\\*\\\\*\\\\K[^*]+' || true)\n        echo \"  Activated: \\$activated\"\n        \n        if [ -n \"\\$expected_skills\" ]; then\n            for skill in \\$expected_skills; do\n                if echo \"\\$activated\" | grep -q \"\\$skill\"; then\n                    echo \"  ‚úì Expected skill activated: \\$skill\"\n                else\n                    echo \"  ‚úó Missing expected skill: \\$skill\"\n                fi\n            done\n        fi\n    else\n        echo \"  No skills activated\"\n    fi\n    \n    echo \"\"\n}\n\n# Test 1: TDD prompt should activate test-driven-development\ntest_prompt \"I want to write a test for the login function\" \"test-driven-development\"\n\n# Test 2: Debugging prompt should activate debugging-with-tools\ntest_prompt \"Help me debug this error in my code\" \"debugging-with-tools\"\n\n# Test 3: Planning prompt should activate brainstorming\ntest_prompt \"I want to design a new authentication system\" \"brainstorming\"\n\n# Test 4: Refactoring prompt should activate refactoring-safely\ntest_prompt \"Let's refactor this code to be cleaner\" \"refactoring-safely\"\n\n# Test 5: Empty prompt should return continue with no context\ntest_prompt \"\" \"\"\n\necho \"=== All Tests Complete ===\"\n\\`\\`\\`\n\n**Step 8: Make test script executable and run**\n\nRun:\n\\`\\`\\`bash\nchmod +x hooks/user-prompt-submit/test-hook.sh\nbash hooks/user-prompt-submit/test-hook.sh\n\\`\\`\\`\n\nExpected: All tests pass with appropriate skills activated\n\n**Step 9: Test performance**\n\nRun:\n\\`\\`\\`bash\ntime echo '{\"text\": \"I want to implement a new feature with TDD\"}' | node hooks/user-prompt-submit/10-skill-activator.js\n\\`\\`\\`\n\nExpected: Completes in \u003c100ms\n\n**Step 10: Test error handling**\n\nRun:\n\\`\\`\\`bash\n# Test with malformed JSON\necho 'invalid json' | node hooks/user-prompt-submit/10-skill-activator.js\n\\`\\`\\`\n\nExpected: Returns \\`{\"decision\":\"continue\"}\\` without crashing\n\n### Step Group 4: Integration Testing\n\n**Files:**\n- All created files\n\n**Step 11: Test in Claude Code environment (manual)**\n\nThis requires testing in an actual Claude Code session to verify the hook activates:\n\n1. Open a new Claude Code session in this project\n2. Type prompt: \"I want to write a test for authentication\"\n3. Observe if skill activation check appears before Claude's response\n4. Verify test-driven-development skill is suggested\n\n**Step 12: Debug if needed**\n\nIf hook doesn't activate, enable debug mode:\n\nRun:\n\\`\\`\\`bash\nexport DEBUG_HOOKS=true\n\\`\\`\\`\n\nThen check Claude Code logs for error messages from the hook.\n\n### Step Group 5: Commit Implementation\n\n**Step 13: Commit all files**\n\nRun:\n\\`\\`\\`bash\ngit add hooks/user-prompt-submit/10-skill-activator.js \\\\\n        hooks/user-prompt-submit/test-hook.sh \\\\\n        hooks/hooks.json\ngit commit -m \"\\$(cat \u003c\u003c'EOF'\nfeat(bd-4): implement UserPromptSubmit hook for skill activation\n\nImplements bd-4: UserPromptSubmit Hook (Skill Activator)\n- Created hooks/user-prompt-submit/10-skill-activator.js (Node.js hook)\n- Analyzes prompts using skill-rules.json patterns\n- Returns top 3 matching skills sorted by priority\n- Injects skill activation check as additionalContext\n- Handles errors gracefully (always returns decision: continue)\n- Performance: \u003c100ms for typical prompts\n- Manual testing script included\n- Updated hooks.json with UserPromptSubmit configuration\n\nThe hook parses user prompts, matches against keyword and intent patterns\nfrom skill-rules.json, and injects a skill activation reminder showing\nthe top 3 relevant skills before Claude processes the prompt.\n\nü§ñ Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude \u003cnoreply@anthropic.com\u003e\nEOF\n)\"\n\\`\\`\\`\n\nExpected: Commit successful\n\n**Step 14: Verify commit**\n\nRun:\n\\`\\`\\`bash\ngit log -1 --stat\n\\`\\`\\`\n\nExpected: Shows commit with 3 files changed\n\n## Key Considerations\n- **Error Handling**: Hook must ALWAYS return \\`{\"decision\": \"continue\"}\\` even on error - never block user\n- **Performance**: Keep analysis \u003c100ms - limit to top 3 skills to avoid context overload\n- **Priority Sorting**: critical \u003e high \u003e medium \u003e low, then process \u003e domain \u003e workflow\n- **Debug Mode**: Use DEBUG_HOOKS=true environment variable for troubleshooting\n- **Pattern Safety**: All regex patterns in skill-rules.json use lazy quantifiers to avoid catastrophic backtracking\n- **Graceful Degradation**: If skill-rules.json missing or malformed, return continue with no context\n- **JSON Output**: Must output valid JSON to stdout - errors go to stderr\n\n## Anti-patterns to Avoid\n- ‚ùå Blocking user if hook fails (always return decision: continue)\n- ‚ùå Loading skill-rules.json on every pattern check (load once at start)\n- ‚ùå Activating too many skills (limit to 3 to avoid context pollution)\n- ‚ùå Forgetting to make script executable (chmod +x)\n- ‚ùå Hardcoding paths instead of using __dirname and path.join\n- ‚ùå Not handling malformed JSON input gracefully\n- ‚ùå Using synchronous file operations in hot path (acceptable here since once per prompt)\n- ‚ùå Assuming Node.js modules available (only use built-in: fs, path)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-30T13:57:03.288291-04:00","updated_at":"2025-10-30T15:33:42.356753-04:00","closed_at":"2025-10-30T15:33:42.356753-04:00","dependencies":[{"issue_id":"bd-4","depends_on_id":"bd-1","type":"parent-child","created_at":"2025-10-30T13:57:10.484473-04:00","created_by":"ryan"},{"issue_id":"bd-4","depends_on_id":"bd-3","type":"blocks","created_at":"2025-10-30T13:57:16.831676-04:00","created_by":"ryan"}]}
{"id":"bd-47f","title":"Convert fixing-bugs to Flow skill","description":"Convert fixing-bugs skill to Kimi CLI Flow format.\n\nBug fixing workflow:\n1. Discovery - identify the bug\n2. Investigation - use debugger, internet-researcher\n3. Root cause - trace to original trigger\n4. Test - write failing test reproducing bug\n5. Fix - minimal fix addressing root cause\n6. Verify - run full test suite\n7. Close - document and close bd issue\n\n```mermaid\nflowchart TD\n    BEGIN[Bug Discovered] --\u003e CREATE[Create bd bug issue]\n    CREATE --\u003e INVESTIGATE[Debug with tools]\n    INVESTIGATE --\u003e ROOT[Trace root cause]\n    ROOT --\u003e FOUND{Root cause found?}\n    FOUND --\u003e|No| RESEARCH[Use internet-researcher]\n    RESEARCH --\u003e INVESTIGATE\n    FOUND --\u003e|Yes| TEST[Write failing test]\n    TEST --\u003e FAILS{Test fails?}\n    FAILS --\u003e|No| FIX_TEST[Improve test]\n    FIX_TEST --\u003e TEST\n    FAILS --\u003e|Yes| IMPLEMENT[Implement fix]\n    IMPLEMENT --\u003e PASSES{Test passes?}\n    PASSES --\u003e|No| IMPLEMENT\n    PASSES --\u003e|Yes| SUITE[Run full test suite]\n    SUITE --\u003e ALL_PASS{All tests pass?}\n    ALL_PASS --\u003e|No| REGRESS[Fix regressions]\n    REGRESS --\u003e SUITE\n    ALL_PASS --\u003e|Yes| CLOSE[Close bd issue]\n    CLOSE --\u003e END[Complete]\n```\n\n## Acceptance Criteria\n- [ ] type: flow in frontmatter\n- [ ] Full bug workflow as Mermaid flowchart\n- [ ] Integration with debugging tools\n- [ ] Test-driven fix verification","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:27:36.743871741+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T20:39:52.575345342+02:00","closed_at":"2026-02-01T20:39:52.575345342+02:00","close_reason":"Converted to Flow skill with Mermaid flowchart","dependencies":[{"issue_id":"bd-47f","depends_on_id":"bd-n1c","type":"blocks","created_at":"2026-02-01T20:31:04.884353111+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-47f","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:15.338005304+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-48","title":"Feature: Add Codex CLI full parity support","design":"## Requirements (IMMUTABLE)\n- Requirement 1: The project MUST support Codex CLI skills with full parity targets for this phase: skills bundle generation/sync, installer, documentation, and parity tests.\n- Requirement 2: Root assets (`skills/*/SKILL.md`, `agents/*.md`, `commands/*.md`) MUST remain the single source of truth.\n- Requirement 3: A deterministic Codex sync flow MUST generate/update repo-scoped Codex-compatible skills under `.agents/skills/**`.\n- Requirement 4: An installer MUST support local and global Codex skill installation paths with safe backup behavior.\n- Requirement 5: CI/automated tests MUST detect stale generated artifacts, naming conflicts, and structural invalidity.\n\n## Effort Estimate\n- 24-32 hours total across iterative tasks\n\n## Success Criteria (MUST ALL BE TRUE)\n- [ ] Codex-compatible skills are generated from root assets and discovered correctly in repo scope (`.agents/skills`).\n- [ ] Installer supports local and global install modes with documented behavior.\n- [ ] README and Codex-specific install docs are updated and accurate.\n- [ ] Automated tests cover generation parity, name collisions, description quality, and installer behavior.\n- [ ] `node scripts/sync-codex-skills.js --check` provides reliable drift detection in CI.\n- [ ] All tests passing.\n- [ ] Pre-commit hooks passing.\n\n## Anti-Patterns (FORBIDDEN)\n- ‚ùå NO manual long-term duplication of Codex skill content outside generated/synced flow (reason: drift risk and parity erosion).\n- ‚ùå NO changing root canonical structure to be Codex-only (reason: must preserve multi-platform compatibility).\n- ‚ùå NO vague skill descriptions without trigger boundaries (reason: weak implicit matching in Codex).\n- ‚ùå NO best-effort generation with warnings-only on collisions/stale artifacts (reason: must fail-fast to prevent silent breakage).\n\n## Approach\nImplement a Codex support layer that derives Codex-compatible skills from existing canonical assets instead of introducing a separate hand-maintained source. This keeps current platform integrations intact while adding Codex-specific output and installation workflows.\n\nThe implementation will provide deterministic generation/sync, then validate output via dedicated tests that guard against regression and drift. Documentation and installation scripts will make adoption straightforward for both repository-local and global user scopes.\n\n## Architecture\n- Canonical source: `skills/*/SKILL.md`, `agents/*.md`, `commands/*.md`\n- Codex generated target: `.agents/skills/\u003cskill\u003e/SKILL.md` (+ optional references/scripts when needed)\n- Sync tooling: `scripts/sync-codex-skills.*`\n- Installer: `scripts/install-codex-plugin.sh`\n- Docs: `.codex/INSTALL.md`, `README.md`\n- Test surface: `tests/codex-*.test.js`\n\n## Key Considerations (Edge Cases \u0026 Failure Modes)\n- Name collisions after normalization/slugging must fail fast.\n- Missing or malformed source metadata must fail with actionable diagnostics.\n- Generated output must be deterministic across environments to keep diffs stable.\n- Removed source entries must be detected as stale generated artifacts.\n- Installation path differences (repo-scoped vs global) must be explicit and safe.\n\n## Design Rationale\n### Problem\nThe repository currently has strong integrations for Claude Code/OpenCode/Kimi but lacks Codex CLI parity. Without a structured Codex layer, users must manually recreate workflows and consistency degrades over time.\n\n### Research Findings\n**Codebase:**\n- `.claude-plugin/plugin.json` - Existing Claude integration metadata and packaging pattern.\n- `hooks/hooks.json` - Canonical hook registry used by one platform integration.\n- `.opencode/plugins/hyperpowers-skills.ts` - OpenCode-specific skills integration behavior.\n- `scripts/install-opencode-plugin.sh` - Robust installer pattern (copy/symlink, backups, validation).\n- `scripts/install-kimi-plugin.sh` - Additional parity reference for multi-platform packaging.\n- `README.md` - Platform sections exist for OpenCode/Claude but no Codex section yet.\n\n**External:**\n- OpenAI Codex Skills overview: https://developers.openai.com/codex/skills/\n- OpenAI create-skill guide: https://developers.openai.com/codex/skills/create-skill/\n- Codex OSS docs reference: https://github.com/openai/codex/blob/main/docs/skills.md\n- Key constraint: Codex implicit invocation quality depends heavily on precise skill descriptions and boundaries.\n\n### Approaches Considered\n1. **Generated Codex layer from canonical sources** ‚úì\n   - Pros: Minimal drift, deterministic parity, maintainable long-term.\n   - Cons: Additional tooling complexity.\n   - **Chosen because:** Delivers full parity goals while preserving existing architecture and reducing maintenance risk.\n\n2. **Static hand-maintained `.codex` skill bundle**\n   - Pros: Fast initial setup.\n   - Cons: High drift risk and repeated manual updates.\n   - **Rejected because:** Contradicts parity durability and source-of-truth constraints.\n\n3. **Codex-first rewrite without parity guarantees**\n   - Pros: Potentially very native Codex UX.\n   - Cons: Large effort, divergence from current ecosystem.\n   - **Rejected because:** Not aligned with requested full parity scope.\n\n### Scope Boundaries\n**In scope:**\n- Codex skills compatibility layer\n- Installer (local/global)\n- Docs updates\n- Parity/quality automated tests\n\n**Out of scope (deferred/never):**\n- Re-architecting existing Claude/OpenCode/Kimi plugin internals\n- Non-skill Codex runtime features not documented in official Skills interface\n- Broad refactor of all historical platform docs unrelated to Codex adoption\n\n### Open Questions\n- Exact naming scheme for generated wrappers from agents/commands (`codex-agent-*` and `codex-command-*`) and collision policy.\n- Whether selected Codex helper skills should include additional `references/` assets in phase 1 or defer to phase 2.","status":"open","priority":1,"issue_type":"epic","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-09T12:59:28.653441+03:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-09T13:00:32.771042+03:00"}
{"id":"bd-49","title":"Task 1: Build deterministic Codex skills sync pipeline","design":"## Goal\nDeliver deterministic generation/sync of Codex-compatible skills from canonical root assets into `.agents/skills/**`, with validation that catches real drift/failure scenarios (not superficial checks).\n\n## Effort Estimate\n- 6-8 hours\n\n## Implementation\n1. Study existing code and conventions\n   - `scripts/install-opencode-plugin.sh` and `scripts/install-kimi-plugin.sh` for installer/packaging conventions.\n   - `skills/*/SKILL.md`, `agents/*.md`, `commands/*.md` as canonical source layout.\n   - `tests/cass-memory.test.js` and `tests/cass-memory-hook.test.js` for Node test style.\n\n2. Write tests first (RED)\n   - Add failing tests for deterministic ordering/output.\n   - Add failing tests for collision and malformed source detection.\n   - Add failing tests for stale generated artifacts and required Codex structure.\n\n3. Implement sync pipeline (GREEN)\n   - Add `scripts/sync-codex-skills.js` with explicit modes:\n     - `--write`: generate/update `.agents/skills/**`\n     - `--check`: verify generated output is current and fail on drift\n   - Implement stable slugging and canonical name mapping.\n   - Enforce fail-fast on collisions, malformed skill metadata, and orphan generated directories.\n\n4. Refactor and harden (REFACTOR)\n   - Make output idempotent and sorted deterministically.\n   - Improve error messages with actionable remediation steps.\n\n## Implementation Checklist\n- [ ] `scripts/sync-codex-skills.js` - parse canonical skills metadata (`name`, `description`) and validate required fields.\n- [ ] `scripts/sync-codex-skills.js` - generate deterministic `.agents/skills/\u003cslug\u003e/SKILL.md` content.\n- [ ] `scripts/sync-codex-skills.js` - map `agents/*.md` and `commands/*.md` into explicit Codex wrapper skill entries.\n- [ ] `scripts/sync-codex-skills.js` - detect and fail on slug collisions (case/normalization aware).\n- [ ] `scripts/sync-codex-skills.js` - detect stale/orphan generated directories and fail in `--check` mode.\n- [ ] `tests/codex-skill-sync.test.js` - verify completeness + deterministic output.\n- [ ] `tests/codex-name-collision.test.js` - verify collisions fail with actionable errors.\n- [ ] `tests/codex-skill-structure.test.js` - verify every generated skill has required `SKILL.md` shape.\n\n## Success Criteria\n- [ ] `node scripts/sync-codex-skills.js --write` generates Codex-compatible skills from canonical sources without manual edits.\n- [ ] `node scripts/sync-codex-skills.js --check` exits non-zero when generated output is stale/orphaned and zero when in sync.\n- [ ] Collision/malformed-source failures include actionable messages identifying offending files.\n- [ ] Test suite includes meaningful bug-catching scenarios (determinism, collision, malformed metadata, stale artifacts).\n- [ ] New Codex sync tests pass.\n- [ ] Existing test suite remains green.\n- [ ] Pre-commit hooks passing.\n\n## Key Considerations (Edge Cases \u0026 Failure Modes)\n- **Malformed metadata:** missing/invalid frontmatter in source skill must fail with file path + fix guidance.\n- **Normalization collisions:** names differing only by case or punctuation must not silently overwrite output.\n- **Unicode/locale behavior:** slugging must be stable and deterministic across environments.\n- **Orphaned artifacts:** removed/renamed source skills must trigger stale artifact detection in `--check` mode.\n- **Partial write safety:** generator must avoid silently leaving mixed old/new state after failure.\n\n## Anti-patterns (FORBIDDEN)\n- ‚ùå No warning-only behavior on collisions or malformed metadata (must fail-fast).\n- ‚ùå No non-deterministic generation order (must be stable to keep diffs reliable).\n- ‚ùå No tautological tests (e.g., checking only file existence without content/behavior assertions).\n- ‚ùå No manual edits inside generated `.agents/skills/**` as long-term workflow.","status":"closed","priority":1,"issue_type":"feature","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-09T12:59:38.296857+03:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-09T13:40:07.893165+03:00","closed_at":"2026-02-09T13:40:07.893165+03:00","close_reason":"Closed","dependencies":[{"issue_id":"bd-49","depends_on_id":"bd-48","type":"parent-child","created_at":"2026-02-09T13:32:59.433977+03:00","created_by":"import"}]}
{"id":"bd-4ab","title":"Convert brainstorming to Flow skill","description":"Convert brainstorming skill to Kimi CLI Flow format.\n\nBrainstorming uses Socratic method with branching Q\u0026A:\n\n```mermaid\nflowchart TD\n    BEGIN[Start Brainstorm] --\u003e TOPIC{Topic provided?}\n    TOPIC --\u003e|No| ASK_TOPIC[Ask for topic]\n    ASK_TOPIC --\u003e TOPIC\n    TOPIC --\u003e|Yes| Q1[Question 1: Clarify scope]\n    Q1 --\u003e A1[User answers]\n    A1 --\u003e Q2[Question 2: Identify constraints]\n    Q2 --\u003e A2[User answers]\n    A2 --\u003e Q3[Question 3: Define success criteria]\n    Q3 --\u003e A3[User answers]\n    A3 --\u003e REFINE{More refinement needed?}\n    REFINE --\u003e|Yes| FOLLOWUP[Ask follow-up question]\n    FOLLOWUP --\u003e REFINE\n    REFINE --\u003e|No| SUMMARIZE[Summarize requirements]\n    SUMMARIZE --\u003e CREATE{Create bd epic?}\n    CREATE --\u003e|Yes| EPIC[Create bd epic with tasks]\n    EPIC --\u003e END[Complete]\n    CREATE --\u003e|No| END\n```\n\n## Acceptance Criteria\n- [ ] type: flow in frontmatter\n- [ ] Socratic Q\u0026A flow as Mermaid\n- [ ] Refinement loop\n- [ ] bd epic creation decision","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:27:52.774284135+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T20:39:52.623921274+02:00","closed_at":"2026-02-01T20:39:52.623921274+02:00","close_reason":"Converted to Flow skill with Mermaid flowchart","dependencies":[{"issue_id":"bd-4ab","depends_on_id":"bd-n1c","type":"blocks","created_at":"2026-02-01T20:31:05.386524246+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-4ab","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:15.661570319+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-4hb","title":"Convert test-driven-development to Flow skill","description":"Convert test-driven-development skill to Kimi CLI Flow format.\n\nThe TDD cycle is a perfect state machine:\n- RED: Write failing test\n- GREEN: Write minimal code to pass\n- REFACTOR: Clean up while keeping tests green\n\n```mermaid\nflowchart TD\n    BEGIN[Start TDD] --\u003e RED[Write failing test]\n    RED --\u003e VERIFY_RED{Test fails?}\n    VERIFY_RED --\u003e|No| FIX_TEST[Fix test to actually test something]\n    FIX_TEST --\u003e RED\n    VERIFY_RED --\u003e|Yes| GREEN[Write minimal code]\n    GREEN --\u003e VERIFY_GREEN{Test passes?}\n    VERIFY_GREEN --\u003e|No| GREEN\n    VERIFY_GREEN --\u003e|Yes| REFACTOR[Refactor code]\n    REFACTOR --\u003e VERIFY_REFACTOR{Tests still pass?}\n    VERIFY_REFACTOR --\u003e|No| UNDO[Undo refactor]\n    UNDO --\u003e REFACTOR\n    VERIFY_REFACTOR --\u003e|Yes| MORE{More to implement?}\n    MORE --\u003e|Yes| RED\n    MORE --\u003e|No| END[Complete]\n```\n\n## Acceptance Criteria\n- [ ] type: flow in frontmatter\n- [ ] RED/GREEN/REFACTOR cycle as Mermaid flowchart\n- [ ] Verification steps at each phase\n- [ ] Loop back for multiple features","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:27:30.090113579+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T20:39:52.540705775+02:00","closed_at":"2026-02-01T20:39:52.540705775+02:00","close_reason":"Converted to Flow skill with Mermaid flowchart","dependencies":[{"issue_id":"bd-4hb","depends_on_id":"bd-n1c","type":"blocks","created_at":"2026-02-01T20:31:04.618011836+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-4hb","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:15.181195075+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-4j3","title":"Feature: Hyperpowers OpenCode bundle + beads triage","description":"## Requirements (IMMUTABLE)\n- Hyperpowers installs via git clone to `~/.config/opencode/hyperpowers` with plugin symlink, matching Superpowers pattern.\n- OpenCode auto-discovers from plural directories: `.opencode/commands`, `.opencode/agents`, `.opencode/plugins`, `.opencode/skills` (no singular dirs remaining).\n- Add `/beads-triage` command and `beads-triage` skill in OpenCode bundle.\n- `beads-triage` runs `bv --robot-triage` directly; if `bv` is missing, it installs via the official install script and retries.\n- `beads-triage` accepts optional scope args (label/track/etc.) and passes them through to `bv --robot-triage`.\n- Skill output is raw JSON only (no summary).\n- Installation docs explain bundle layout, plugin symlink, and `beads-triage` usage.\n\n## Success Criteria (MUST ALL BE TRUE)\n- [ ] OpenCode discovers commands, agents, skills, and plugin from plural `.opencode/*` directories.\n- [ ] `/beads-triage` runs `bv --robot-triage` and returns raw JSON.\n- [ ] Missing `bv` triggers automated install before running triage.\n- [ ] Optional scope args are passed to `bv --robot-triage`.\n- [ ] Installation docs updated with new bundle layout and triage instructions.\n- [ ] No singular `.opencode/command`, `.opencode/agent`, `.opencode/plugin` directories remain.\n\n## Anti-Patterns (FORBIDDEN)\n- ‚ùå Running bare `bv` (must always use `--robot-triage` to avoid TUI blocking).\n- ‚ùå Summarizing triage output (raw JSON only).\n- ‚ùå Prompting user to manually run `bv --robot-triage` (skill must run it directly).\n- ‚ùå Keeping singular `.opencode/command`, `.opencode/agent`, `.opencode/plugin` directories.\n\n## Approach\nAdopt the Superpowers-style local bundle: clone to `~/.config/opencode/hyperpowers` and symlink the plugin into `~/.config/opencode/plugins/`. Migrate `.opencode` directories to plural names so OpenCode auto-discovers commands, agents, plugins, and skills. Add a `beads-triage` skill and `/beads-triage` command that executes `bv --robot-triage` with optional args; if `bv` is missing, install using the official script before executing. Update installation docs to explain the bundle layout and triage usage.\n\n## Architecture\n- `.opencode/skills/beads-triage/SKILL.md` - New skill driving `bv --robot-triage` behavior\n- `.opencode/commands/beads-triage.md` - Command wrapper for the skill\n- `.opencode/plugins/hyperpowers-skills.ts` - Plugin for `use_skill`/`find_skills` tools and bootstrap injection\n- `.opencode/INSTALL.md` - Updated installation docs\n\n## Design Rationale\n### Problem\nHyperpowers needs a one-step OpenCode installation that bundles commands, agents, hooks, and skills, plus actionable bv graph analysis via bd integration.\n\n### Research Findings\n**Codebase:**\n- `.opencode/command`, `.opencode/agent`, `.opencode/plugin` exist today (singular) and should be migrated to plural for OpenCode auto-discovery.\n- `hyperpowers-skills.ts` already provides `use_skill`/`find_skills` tool behavior.\n\n**External:**\n- OpenCode docs confirm auto-discovery from plural `.opencode/commands`, `.opencode/agents`, `.opencode/plugins`, `.opencode/skills`.\n- `bv --robot-triage` provides JSON output and is the safe non-TUI entry point.\n- `bv` official install uses a curl-based install script.\n\n### Approaches Considered\n1. **Local bundle with plural `.opencode/*` (Chosen)**\n   - Pros: Matches Superpowers pattern; zero npm packaging complexity; OpenCode auto-discovery works.\n   - Cons: Requires git clone + symlink step.\n   - **Chosen because:** Aligns with OpenCode discovery and existing hyperpowers skill tooling.\n\n2. **Hybrid bundle + npm plugin**\n   - Pros: Smaller local footprint.\n   - Cons: Two install methods; more moving parts.\n   - **Rejected because:** Adds complexity with little benefit.\n\n3. **Npm-only plugin**\n   - Pros: Single install command.\n   - Cons: OpenCode doesn‚Äôt auto-discover skills/commands from npm packages.\n   - **Rejected because:** Not supported by OpenCode.\n\n### Scope Boundaries\n**In scope:**\n- Bundle layout migration to plural `.opencode/*`\n- New `beads-triage` skill + command\n- Updated installation docs\n\n**Out of scope (deferred/never):**\n- Additional bv robot modes (insights/graph) beyond triage\n- CLI wrappers outside OpenCode\n\n### Open Questions\n- None","status":"closed","priority":2,"issue_type":"epic","owner":"dmitry.polishuk@gmail.com","created_at":"2026-01-20T14:06:03.637086+03:00","created_by":"Dmitry Polishuk","updated_at":"2026-01-20T14:42:39.95947+03:00","closed_at":"2026-01-20T14:42:39.95947+03:00","close_reason":"All tasks completed; implementation reviewed and approved."}
{"id":"bd-4lt","title":"Convert executing-plans to Flow skill","description":"Convert executing-plans skill to Kimi CLI Flow format.\n\nPlan execution workflow:\n1. Load next ready task from bd\n2. Execute task\n3. Review learnings\n4. Update/create follow-up tasks\n5. Stop for user review (or continue in Ralph mode)\n\n```mermaid\nflowchart TD\n    BEGIN[Start Execution] --\u003e READY[bd ready - get next task]\n    READY --\u003e HAS_TASK{Task available?}\n    HAS_TASK --\u003e|No| END[All tasks complete]\n    HAS_TASK --\u003e|Yes| CLAIM[Mark in_progress]\n    CLAIM --\u003e EXECUTE[Execute task]\n    EXECUTE --\u003e VERIFY[Verify completion]\n    VERIFY --\u003e PASSED{Verification passed?}\n    PASSED --\u003e|No| FIX[Fix issues]\n    FIX --\u003e VERIFY\n    PASSED --\u003e|Yes| LEARNINGS[Document learnings]\n    LEARNINGS --\u003e UPDATE[Update bd task]\n    UPDATE --\u003e CLOSE[Close task]\n    CLOSE --\u003e CHECKPOINT{User checkpoint?}\n    CHECKPOINT --\u003e|Yes| PAUSE[Wait for user]\n    PAUSE --\u003e READY\n    CHECKPOINT --\u003e|No| READY\n```\n\n## Acceptance Criteria\n- [ ] type: flow in frontmatter\n- [ ] Task execution loop as Mermaid flowchart\n- [ ] bd integration points shown\n- [ ] User checkpoint decision node","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:27:42.242455611+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T20:39:52.605836715+02:00","closed_at":"2026-02-01T20:39:52.605836715+02:00","close_reason":"Converted to Flow skill with Mermaid flowchart","dependencies":[{"issue_id":"bd-4lt","depends_on_id":"bd-n1c","type":"blocks","created_at":"2026-02-01T20:31:05.098994075+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-4lt","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:15.495663858+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-5","title":"Phase 4: PostToolUse Hook (Context Tracker)","design":"## Goal\nImplement hook that tracks file edits and maintains context.\n\n## Effort Estimate\n8-10 hours\n\n## Success Criteria\n- [ ] PostToolUse hook created and configured in hooks.json\n- [ ] Hook tracks Edit and Write tool usage\n- [ ] Context logged with: timestamp, repo, file_path, tool_name\n- [ ] Log stored in hooks/context/edit-log.txt\n- [ ] Log rotation prevents unbounded growth (max 1000 lines)\n- [ ] Non-blocking operation (always returns success)\n- [ ] Hook handles missing/malformed input gracefully\n- [ ] Manual testing shows correct logging of file edits\n- [ ] Context accessible to downstream hooks (bd-6)\n- [ ] Race condition prevention via file locking\n\n## Implementation Steps (ADDED BY writing-plans, REFINED BY SRE)\n\n### Step Group 1: Create Context Storage Infrastructure\n\n**Files:**\n- Create: hooks/context/ (directory)\n- Create: hooks/post-tool-use/01-track-edits.sh\n- Modify: hooks/hooks.json\n\n**Step 1: Create directories**\nRun:\n\\`\\`\\`bash\nmkdir -p hooks/post-tool-use hooks/context\n\\`\\`\\`\n\n**Step 2: Create the edit tracker script**\n\nCreate \\`hooks/post-tool-use/01-track-edits.sh\\`:\n\n\\`\\`\\`bash\n#!/usr/bin/env bash\nset -euo pipefail\n\n# Configuration\nCONTEXT_DIR=\"$(dirname \"$0\")/../context\"\nLOG_FILE=\"$CONTEXT_DIR/edit-log.txt\"\nLOCK_FILE=\"$CONTEXT_DIR/.edit-log.lock\"\nMAX_LOG_LINES=1000\nLOCK_TIMEOUT=5\n\n# Create context dir and log if doesn't exist\nmkdir -p \"$CONTEXT_DIR\"\ntouch \"$LOG_FILE\"\n\n# Acquire lock with timeout\nacquire_lock() {\n    local count=0\n    while [ $count -lt $LOCK_TIMEOUT ]; do\n        if mkdir \"$LOCK_FILE\" 2\u003e/dev/null; then\n            return 0\n        fi\n        sleep 0.2\n        count=$((count + 1))\n    done\n    # Log but don't fail - non-blocking requirement\n    echo \"Warning: Could not acquire lock\" \u003e\u00262\n    return 1\n}\n\n# Release lock\nrelease_lock() {\n    rmdir \"$LOCK_FILE\" 2\u003e/dev/null || true\n}\n\n# Clean up lock on exit\ntrap release_lock EXIT\n\n# Function to log edit\nlog_edit() {\n    local file_path=\"$1\"\n    local tool_name=\"$2\"\n    local timestamp=$(date +\"%Y-%m-%d %H:%M:%S\")\n    local repo=$(find_repo \"$file_path\")\n\n    if acquire_lock; then\n        echo \"$timestamp | $repo | $tool_name | $file_path\" \u003e\u003e \"$LOG_FILE\"\n        release_lock\n    fi\n}\n\n# Function to find repo root\nfind_repo() {\n    local file_path=\"$1\"\n    if [ -z \"$file_path\" ] || [ \"$file_path\" = \"null\" ]; then\n        echo \"unknown\"\n        return\n    fi\n\n    local dir\n    dir=$(dirname \"$file_path\" 2\u003e/dev/null || echo \"/\")\n    while [ \"$dir\" != \"/\" ] \u0026\u0026 [ -n \"$dir\" ]; do\n        if [ -d \"$dir/.git\" ]; then\n            basename \"$dir\"\n            return\n        fi\n        dir=$(dirname \"$dir\" 2\u003e/dev/null || echo \"/\")\n    done\n    echo \"unknown\"\n}\n\n# Read tool use event from stdin (with timeout to prevent hanging)\nif ! read -t 2 -r tool_use_json; then\n    echo '{\"decision\": \"continue\"}'\n    exit 0\nfi\n\n# Validate JSON to prevent injection\nif ! echo \"$tool_use_json\" | jq empty 2\u003e/dev/null; then\n    echo '{\"decision\": \"continue\"}'\n    exit 0\nfi\n\n# Extract tool name and file path from tool use\ntool_name=$(echo \"$tool_use_json\" | jq -r '.tool.name // .tool_name // \"unknown\"' 2\u003e/dev/null || echo \"unknown\")\nfile_path=\"\"\n\ncase \"$tool_name\" in\n    \"Edit\"|\"Write\")\n        file_path=$(echo \"$tool_use_json\" | jq -r '.tool.input.file_path // .tool_input.file_path // \"null\"' 2\u003e/dev/null || echo \"null\")\n        ;;\n    \"MultiEdit\")\n        # MultiEdit has multiple files - log each\n        echo \"$tool_use_json\" | jq -r '.tool.input.edits[]?.file_path // .tool_input.edits[]?.file_path // empty' 2\u003e/dev/null | while read -r path; do\n            if [ -n \"$path\" ] \u0026\u0026 [ \"$path\" != \"null\" ]; then\n                log_edit \"$path\" \"$tool_name\"\n            fi\n        done\n        echo '{\"decision\": \"continue\"}'\n        exit 0\n        ;;\nesac\n\n# Log single edit\nif [ -n \"$file_path\" ] \u0026\u0026 [ \"$file_path\" != \"null\" ]; then\n    log_edit \"$file_path\" \"$tool_name\"\nfi\n\n# Rotate log if too large (with lock)\nif acquire_lock; then\n    line_count=$(wc -l \u003c \"$LOG_FILE\" 2\u003e/dev/null || echo \"0\")\n    if [ \"$line_count\" -gt \"$MAX_LOG_LINES\" ]; then\n        tail -n \"$MAX_LOG_LINES\" \"$LOG_FILE\" \u003e \"$LOG_FILE.tmp\"\n        mv \"$LOG_FILE.tmp\" \"$LOG_FILE\"\n    fi\n    release_lock\nfi\n\n# Return success (non-blocking)\necho '{\"decision\": \"continue\"}'\n\\`\\`\\`\n\n**Step 3: Make script executable**\nRun:\n\\`\\`\\`bash\nchmod +x hooks/post-tool-use/01-track-edits.sh\n\\`\\`\\`\n\n### Step Group 2: Create Context Query Utilities\n\n**Step 4: Create context query utilities**\n\nCreate \\`hooks/utils/context-query.sh\\`:\n\n\\`\\`\\`bash\n#!/usr/bin/env bash\nset -euo pipefail\n\nCONTEXT_DIR=\"$(dirname \"$0\")/../context\"\nLOG_FILE=\"$CONTEXT_DIR/edit-log.txt\"\n\n# Get files edited since timestamp\nget_recent_edits() {\n    local since=\"${1:-}\"\n    \n    if [ ! -f \"$LOG_FILE\" ]; then\n        return 0\n    fi\n    \n    if [ -z \"$since\" ]; then\n        cat \"$LOG_FILE\" 2\u003e/dev/null || true\n    else\n        awk -v since=\"$since\" -F '|' '$1 \u003e= since' \"$LOG_FILE\" 2\u003e/dev/null || true\n    fi\n}\n\n# Get unique files edited in current session\nget_session_files() {\n    local session_start=\"${1:-}\"\n    \n    get_recent_edits \"$session_start\" | \\\\\n        awk -F '|' '{gsub(/^[ \\\\t]+|[ \\\\t]+$/, \"\", $4); print $4}' | \\\\\n        sort -u\n}\n\n# Check if specific file was edited\nwas_file_edited() {\n    local file_path=\"$1\"\n    local since=\"${2:-}\"\n    \n    get_recent_edits \"$since\" | grep -q \"$(printf '%q' \"$file_path\")\" 2\u003e/dev/null\n}\n\n# Get edit count by repo\nget_repo_stats() {\n    local since=\"${1:-}\"\n    \n    get_recent_edits \"$since\" | \\\\\n        awk -F '|' '{gsub(/^[ \\\\t]+|[ \\\\t]+$/, \"\", $2); print $2}' | \\\\\n        sort | uniq -c | sort -rn\n}\n\n# Clear log (for testing)\nclear_log() {\n    if [ -f \"$LOG_FILE\" ]; then\n        \u003e \"$LOG_FILE\"\n    fi\n}\n\\`\\`\\`\n\n## Key Considerations (ADDED BY SRE REVIEW)\n\n**Race Condition Prevention**:\n- Multiple hooks may run concurrently\n- Use directory-based locking (atomic on most filesystems)\n- Timeout on lock acquisition to prevent deadlock\n- Non-blocking requirement means we log warning but continue\n\n**Input Validation**:\n- Malformed JSON could cause jq to hang or error\n- Use jq empty to validate JSON structure first\n- Read with timeout to prevent hanging on stdin\n\n**Path Security**:\n- File paths may contain spaces, quotes, or shell metacharacters\n- Use proper quoting in all path operations\n- Validate paths don't contain directory traversal (..)\n\n**Disk Full Scenarios**:\n- All writes use \u003e\u003e which will fail gracefully if disk full\n- Log rotation prevents unbounded growth\n- Non-blocking means we continue even if write fails\n\n## Anti-patterns\n- ‚ùå Blocking on I/O or lock acquisition\n- ‚ùå Unbounded log growth without rotation\n- ‚ùå Crashing on malformed input\n- ‚ùå Not handling concurrent access\n- ‚ùå Shell injection via unquoted paths\n- ‚ùå Hanging on stdin read","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-30T13:57:03.298717-04:00","updated_at":"2025-10-30T15:36:27.582323-04:00","closed_at":"2025-10-30T15:36:27.582323-04:00","dependencies":[{"issue_id":"bd-5","depends_on_id":"bd-1","type":"parent-child","created_at":"2025-10-30T13:57:10.497915-04:00","created_by":"ryan"},{"issue_id":"bd-5","depends_on_id":"bd-4","type":"blocks","created_at":"2025-10-30T13:57:16.843566-04:00","created_by":"ryan"}]}
{"id":"bd-6","title":"Phase 5: Stop Hook (Gentle Reminders)","design":"## Goal\nImplement hook that shows self-check reminders after Claude responds.\n\n## Effort Estimate\n4-6 hours\n\n## Success Criteria\n- [ ] Stop hook created and configured in hooks.json\n- [ ] Reads context from edit-log.txt successfully\n- [ ] Shows TDD reminder if .ts/.js/.py files edited without test files\n- [ ] Shows verification reminder if user says \"done\" or \"complete\"\n- [ ] Shows commit reminder if \u003e3 files edited in session\n- [ ] Non-intrusive output (max 5 lines)\n- [ ] Handles missing/empty context gracefully\n- [ ] Performance \u003c50ms\n\n## Implementation Steps (ADDED BY writing-plans, REFINED BY SRE)\n\n### Step 1: Create Stop hook directory\nRun:\n\\`\\`\\`bash\nmkdir -p hooks/stop\n\\`\\`\\`\n\n### Step 2: Create gentle reminders hook\n\nCreate \\`hooks/stop/10-gentle-reminders.sh\\`:\n\n\\`\\`\\`bash\n#!/usr/bin/env bash\nset -euo pipefail\n\n# Configuration\nSCRIPT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" \u0026\u0026 pwd)\"\nCONTEXT_DIR=\"$SCRIPT_DIR/../context\"\nUTILS_DIR=\"$SCRIPT_DIR/../utils\"\nLOG_FILE=\"$CONTEXT_DIR/edit-log.txt\"\nSESSION_START=$(date -d \"1 hour ago\" +\"%Y-%m-%d %H:%M:%S\" 2\u003e/dev/null || date -v-1H +\"%Y-%m-%d %H:%M:%S\")\n\n# Source utilities (if they exist)\nif [ -f \"$UTILS_DIR/context-query.sh\" ]; then\n    source \"$UTILS_DIR/context-query.sh\"\nelse\n    # Fallback if utilities missing\n    get_session_files() {\n        if [ -f \"$LOG_FILE\" ]; then\n            awk -F '|' -v since=\"$SESSION_START\" '$1 \u003e= since {gsub(/^[ \\\\t]+|[ \\\\t]+$/, \"\", $4); print $4}' \"$LOG_FILE\" | sort -u\n        fi\n    }\nfi\n\n# Read response from stdin to check for completion claims\nRESPONSE=\"\"\nif read -t 1 -r response_json 2\u003e/dev/null; then\n    RESPONSE=$(echo \"$response_json\" | jq -r '.text // \"\"' 2\u003e/dev/null || echo \"\")\nfi\n\n# Get edited files in this session\nEDITED_FILES=$(get_session_files \"$SESSION_START\" 2\u003e/dev/null || echo \"\")\nFILE_COUNT=$(echo \"$EDITED_FILES\" | grep -c . 2\u003e/dev/null || echo \"0\")\n\n# Check patterns for appropriate reminders\nSHOW_TDD_REMINDER=false\nSHOW_VERIFY_REMINDER=false\nSHOW_COMMIT_REMINDER=false\n\n# Check 1: Files edited but no test files?\nif [ \"$FILE_COUNT\" -gt 0 ]; then\n    # Check if source files edited\n    if echo \"$EDITED_FILES\" | grep -qE '\\\\.(ts|js|py|go|rs|java)$' 2\u003e/dev/null; then\n        # Check if NO test files edited\n        if ! echo \"$EDITED_FILES\" | grep -qE '(test|spec)\\\\.(ts|js|py|go|rs|java)$' 2\u003e/dev/null; then\n            SHOW_TDD_REMINDER=true\n        fi\n    fi\n    \n    # Check 2: Many files edited?\n    if [ \"$FILE_COUNT\" -ge 3 ]; then\n        SHOW_COMMIT_REMINDER=true\n    fi\nfi\n\n# Check 3: User claiming completion?\nif echo \"$RESPONSE\" | grep -iE '(done|complete|finished|ready|works)' \u003e/dev/null 2\u003e\u00261; then\n    SHOW_VERIFY_REMINDER=true\nfi\n\n# Display appropriate reminders (max 5 lines)\nif [ \"$SHOW_TDD_REMINDER\" = true ] || [ \"$SHOW_VERIFY_REMINDER\" = true ] || [ \"$SHOW_COMMIT_REMINDER\" = true ]; then\n    echo \"\"\n    echo \"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\"\n    \n    if [ \"$SHOW_TDD_REMINDER\" = true ]; then\n        echo \"üí≠ Remember: Write tests first (TDD)\"\n    fi\n    \n    if [ \"$SHOW_VERIFY_REMINDER\" = true ]; then\n        echo \"‚úÖ Before claiming complete: Run tests\"\n    fi\n    \n    if [ \"$SHOW_COMMIT_REMINDER\" = true ]; then\n        echo \"üíæ Consider: $FILE_COUNT files edited - commit?\"\n    fi\n    \n    echo \"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\"\nfi\n\n# Always return success (non-blocking)\nexit 0\n\\`\\`\\`\n\n### Step 3: Make executable\nRun:\n\\`\\`\\`bash\nchmod +x hooks/stop/10-gentle-reminders.sh\n\\`\\`\\`\n\n### Step 4: Update hooks.json\n\nAdd Stop hook configuration to \\`hooks/hooks.json\\` (preserve existing entries):\n\n\\`\\`\\`json\n{\n  \"hooks\": {\n    \"SessionStart\": [...],\n    \"PreToolUse\": [...],\n    \"UserPromptSubmit\": [...],\n    \"PostToolUse\": [...],\n    \"Stop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"${CLAUDE_PLUGIN_ROOT}/hooks/stop/10-gentle-reminders.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n\\`\\`\\`\n\n### Step 5: Create test script\n\nCreate \\`hooks/stop/test-reminders.sh\\`:\n\n\\`\\`\\`bash\n#!/bin/bash\nset -e\n\necho \"=== Testing Stop Hook Reminders ===\"\n\n# Test 1: No edits = no reminder\necho \"Test 1: No edits\"\n\u003e hooks/context/edit-log.txt\necho '{\"text\": \"All done!\"}' | bash hooks/stop/10-gentle-reminders.sh \u003e /tmp/out1.txt\n[ ! -s /tmp/out1.txt ] \u0026\u0026 echo \"‚úì No reminder (correct)\" || echo \"‚úó Unexpected reminder\"\n\n# Test 2: Source file edited without test = TDD reminder\necho \"Test 2: TDD reminder\"\necho \"$(date +\"%Y-%m-%d %H:%M:%S\") | hyper | Edit | src/main.ts\" \u003e hooks/context/edit-log.txt\necho '{\"text\": \"Feature implemented\"}' | bash hooks/stop/10-gentle-reminders.sh \u003e /tmp/out2.txt\ngrep -q \"TDD\" /tmp/out2.txt \u0026\u0026 echo \"‚úì TDD reminder shown\" || echo \"‚úó TDD reminder missing\"\n\n# Test 3: Completion claim = verification reminder\necho \"Test 3: Verification reminder\"\necho '{\"text\": \"All done and tests pass!\"}' | bash hooks/stop/10-gentle-reminders.sh \u003e /tmp/out3.txt\ngrep -q \"Run tests\" /tmp/out3.txt \u0026\u0026 echo \"‚úì Verify reminder shown\" || echo \"‚úó Verify reminder missing\"\n\n# Test 4: Many files = commit reminder\necho \"Test 4: Commit reminder\"\nfor i in {1..5}; do\n    echo \"$(date +\"%Y-%m-%d %H:%M:%S\") | hyper | Edit | src/file$i.ts\" \u003e\u003e hooks/context/edit-log.txt\ndone\necho '{\"text\": \"Refactoring complete\"}' | bash hooks/stop/10-gentle-reminders.sh \u003e /tmp/out4.txt\ngrep -q \"commit\" /tmp/out4.txt \u0026\u0026 echo \"‚úì Commit reminder shown\" || echo \"‚úó Commit reminder missing\"\n\necho \"=== All Tests Complete ===\"\n\\`\\`\\`\n\n### Step 6: Run tests\nRun:\n\\`\\`\\`bash\nchmod +x hooks/stop/test-reminders.sh\nbash hooks/stop/test-reminders.sh\n\\`\\`\\`\n\nExpected: All tests pass\n\n### Step 7: Test performance\nRun:\n\\`\\`\\`bash\ntime echo '{\"text\": \"Done\"}' | bash hooks/stop/10-gentle-reminders.sh\n\\`\\`\\`\n\nExpected: \u003c50ms execution time\n\n### Step 8: Commit\nRun:\n\\`\\`\\`bash\ngit add hooks/stop/10-gentle-reminders.sh hooks/stop/test-reminders.sh hooks/hooks.json\ngit commit -m \"feat(bd-6): implement Stop hook for gentle reminders\n\nImplements bd-6: Stop Hook (Gentle Reminders)\n- Shows TDD reminder when source edited without tests\n- Shows verification reminder when user claims complete\n- Shows commit reminder when many files edited\n- Non-intrusive (max 5 lines output)\n- Performance \u003c50ms\"\n\\`\\`\\`\n\n## Key Considerations (ADDED BY SRE REVIEW)\n\n**Context Availability**:\n- edit-log.txt may not exist (fresh install)\n- PostToolUse hook (bd-5) may not be running\n- Must handle gracefully with fallbacks\n\n**Pattern Matching Accuracy**:\n- Avoid false positives (e.g., \"done\" in middle of sentence)\n- Source vs test file detection must be accurate\n- Consider different naming conventions (test.js, spec.js, _test.go)\n\n**User Experience**:\n- Keep output brief (max 5 lines)\n- Only show relevant reminders, not all\n- Use clear, actionable language\n\n**Performance**:\n- Stop hook runs after every Claude response\n- Must be fast (\u003c50ms) to not delay user\n- Avoid complex processing or external commands\n\n## Anti-patterns\n- ‚ùå Annoying/repetitive reminders every response\n- ‚ùå Blocking on I/O or missing files\n- ‚ùå Long multi-paragraph reminders\n- ‚ùå False positive pattern matching\n- ‚ùå Slow execution delaying response","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-30T13:57:03.309595-04:00","updated_at":"2025-10-30T15:38:52.605286-04:00","closed_at":"2025-10-30T15:38:52.605286-04:00","dependencies":[{"issue_id":"bd-6","depends_on_id":"bd-1","type":"parent-child","created_at":"2025-10-30T13:57:10.518056-04:00","created_by":"ryan"},{"issue_id":"bd-6","depends_on_id":"bd-5","type":"blocks","created_at":"2025-10-30T13:57:16.854063-04:00","created_by":"ryan"}]}
{"id":"bd-7","title":"Phase 6: Update Documentation","design":"## Goal  \nUpdate documentation for new hooks system.\n\n## Effort Estimate\n2-4 hours\n\n## Success Criteria\n- [ ] README.md updated with Hooks System section\n- [ ] Each hook type documented with examples\n- [ ] Installation instructions include hook setup\n- [ ] Troubleshooting section added\n- [ ] skills/skills-auto-activation/SKILL.md references updated\n- [ ] All code examples tested and working\n\n## Implementation Steps (ADDED BY writing-plans, REFINED BY SRE)\n\n### Step 1: Update main README.md\n\nAdd the following section after \"## Features\" in README.md:\n\n\\`\\`\\`markdown\n## Hooks System\n\nHyperpowers includes an intelligent hooks system that provides context-aware assistance:\n\n### Automatic Skill Activation\nWhen you type a prompt, the UserPromptSubmit hook analyzes it and suggests relevant skills:\n\n\\`\\`\\`\nUser: I want to write a test for the login function\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüéØ SKILL ACTIVATION CHECK\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚≠ê **test-driven-development** (high priority, process)\nüìå **debugging-with-tools** (medium priority, process)\n\nUse the Skill tool to activate: \\`Skill command=\"hyperpowers:test-driven-development\"\\`\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\\`\\`\\`\n\n### Context Tracking\nThe PostToolUse hook tracks file edits during your session, maintaining context for intelligent reminders.\n\n### Gentle Reminders\nAfter Claude responds, the Stop hook provides helpful reminders based on context:\n- üí≠ TDD reminder when editing source without tests\n- ‚úÖ Verification reminder when claiming completion\n- üíæ Commit reminder after multiple file edits\n\n### Hook Configuration\n\nHooks are configured in \\`hooks/hooks.json\\`:\n\n\\`\\`\\`json\n{\n  \"hooks\": {\n    \"UserPromptSubmit\": [...],  // Skill activation\n    \"PostToolUse\": [...],        // Context tracking\n    \"Stop\": [...]                // Gentle reminders\n  }\n}\n\\`\\`\\`\n\\`\\`\\`\n\n### Step 2: Create HOOKS.md documentation\n\nCreate \\`HOOKS.md\\` in project root:\n\n\\`\\`\\`markdown\n# Hyperpowers Hooks Documentation\n\n## Overview\nHyperpowers uses Claude Code's hooks system to provide intelligent, context-aware assistance.\n\n## Hook Types\n\n### UserPromptSubmit Hook\n**File:** \\`hooks/user-prompt-submit/10-skill-activator.js\\`\n**Purpose:** Analyzes prompts and suggests relevant skills\n**Input:** \\`{\"text\": \"user prompt text\"}\\`\n**Output:** \\`{\"decision\": \"continue\", \"additionalContext\": \"skill suggestions\"}\\`\n\n**Configuration:**\n- Edit \\`hooks/skill-rules.json\\` to adjust skill triggers\n- Set \\`DEBUG_HOOKS=true\\` for troubleshooting\n\n### PostToolUse Hook  \n**File:** \\`hooks/post-tool-use/01-track-edits.sh\\`\n**Purpose:** Tracks file edits for context\n**Input:** \\`{\"tool\": {\"name\": \"Edit\", \"input\": {\"file_path\": \"...\"}}}\\`\n**Output:** \\`{\"decision\": \"continue\"}\\`\n\n**Context Storage:**\n- Log file: \\`hooks/context/edit-log.txt\\`\n- Format: \\`timestamp | repo | tool | filepath\\`\n- Auto-rotates at 1000 lines\n\n### Stop Hook\n**File:** \\`hooks/stop/10-gentle-reminders.sh\\`\n**Purpose:** Shows context-aware reminders\n**Input:** \\`{\"text\": \"claude's response\"}\\` (optional)\n**Output:** Brief reminders to stdout\n\n## Installation\n\n1. Ensure Node.js is installed (for skill activator)\n2. Hooks auto-activate when plugin is loaded\n3. Verify with: \\`ls hooks/\\`\n\n## Troubleshooting\n\n### Skill activator not working\n\\`\\`\\`bash\n# Enable debug mode\nexport DEBUG_HOOKS=true\n\n# Test manually\necho '{\"text\": \"I want to write a test\"}' | node hooks/user-prompt-submit/10-skill-activator.js\n\\`\\`\\`\n\n### Context not tracking\n\\`\\`\\`bash\n# Check log file\ncat hooks/context/edit-log.txt\n\n# Test manually\necho '{\"tool\": {\"name\": \"Edit\", \"input\": {\"file_path\": \"/test.ts\"}}}' | \\\\\n  bash hooks/post-tool-use/01-track-edits.sh\n\\`\\`\\`\n\n### Reminders not showing\n\\`\\`\\`bash\n# Test manually\necho '{\"text\": \"All done!\"}' | bash hooks/stop/10-gentle-reminders.sh\n\\`\\`\\`\n\n## Customization\n\n### Adjusting skill triggers\nEdit \\`hooks/skill-rules.json\\`:\n\\`\\`\\`json\n{\n  \"skill-name\": {\n    \"priority\": \"high\",\n    \"promptTriggers\": {\n      \"keywords\": [\"test\", \"testing\"],\n      \"intentPatterns\": [\"write.*test\", \"create.*spec\"]\n    }\n  }\n}\n\\`\\`\\`\n\n### Disabling hooks\nRemove from \\`hooks/hooks.json\\` or rename hook file.\n\n## Performance\n\n- UserPromptSubmit: \u003c100ms per prompt\n- PostToolUse: \u003c10ms per edit\n- Stop: \u003c50ms per response\n\\`\\`\\`\n\n### Step 3: Update skills/skills-auto-activation/SKILL.md\n\nAdd reference at the top of the file:\n\n\\`\\`\\`markdown\n---\nname: skills-auto-activation\ndescription: Automatically activated via hooks/user-prompt-submit/10-skill-activator.js\n---\n\n\u003e **Note:** This skill's functionality is now implemented via the hooks system.\n\u003e The UserPromptSubmit hook automatically suggests relevant skills based on your prompts.\n\u003e See HOOKS.md for configuration details.\n\\`\\`\\`\n\n### Step 4: Test documentation examples\n\nRun each code example from the documentation:\n\n\\`\\`\\`bash\n# Test skill activator example\necho '{\"text\": \"I want to write a test for the login function\"}' | \\\\\n  node hooks/user-prompt-submit/10-skill-activator.js | \\\\\n  jq .additionalContext\n\n# Test context tracker example  \necho '{\"tool\": {\"name\": \"Edit\", \"input\": {\"file_path\": \"/test.ts\"}}}' | \\\\\n  bash hooks/post-tool-use/01-track-edits.sh\n\n# Test reminder example\necho '{\"text\": \"All done!\"}' | bash hooks/stop/10-gentle-reminders.sh\n\\`\\`\\`\n\nExpected: All examples work as documented\n\n### Step 5: Commit documentation\n\nRun:\n\\`\\`\\`bash\ngit add README.md HOOKS.md skills/skills-auto-activation/SKILL.md\ngit commit -m \"docs(bd-7): add comprehensive hooks documentation\n\nImplements bd-7: Update Documentation\n- Added Hooks System section to README.md\n- Created detailed HOOKS.md with examples\n- Added troubleshooting guide\n- Updated skill references\n- All examples tested and working\"\n\\`\\`\\`\n\n## Key Considerations (ADDED BY SRE REVIEW)\n\n**Documentation Accuracy**:\n- All code examples MUST be tested\n- File paths must match actual implementation\n- Version requirements (Node.js) must be stated\n\n**User Experience**:\n- Start with benefits, not technical details\n- Provide clear examples before configuration\n- Troubleshooting should cover common issues\n\n**Maintenance**:\n- Documentation must be updated when hooks change\n- Include version/compatibility notes\n- Link to relevant skills and resources\n\n## Anti-patterns\n- ‚ùå Outdated code examples\n- ‚ùå Missing prerequisites (Node.js)\n- ‚ùå Complex explanations before simple examples\n- ‚ùå Documentation that contradicts implementation","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-30T13:57:03.320096-04:00","updated_at":"2025-10-30T15:41:24.506886-04:00","closed_at":"2025-10-30T15:41:24.506886-04:00","dependencies":[{"issue_id":"bd-7","depends_on_id":"bd-1","type":"parent-child","created_at":"2025-10-30T13:57:10.532603-04:00","created_by":"ryan"},{"issue_id":"bd-7","depends_on_id":"bd-6","type":"blocks","created_at":"2025-10-30T13:57:16.864384-04:00","created_by":"ryan"}]}
{"id":"bd-8","title":"Phase 7: Integration Testing","design":"## Goal\nTest complete hook system integration.\n\n## Effort Estimate  \n4-6 hours\n\n## Success Criteria\n- [ ] End-to-end test script created\n- [ ] All 3 hooks tested in sequence\n- [ ] 10+ test scenarios pass\n- [ ] Performance benchmarks documented\n- [ ] Error scenarios handled correctly\n- [ ] No interference between hooks\n- [ ] Clean test environment setup/teardown\n\n## Implementation Steps (ADDED BY writing-plans, REFINED BY SRE)\n\n### Step 1: Create integration test script\n\nCreate \\`hooks/test/integration-test.sh\\`:\n\n\\`\\`\\`bash\n#!/usr/bin/env bash\nset -euo pipefail\n\n# Colors for output\nRED='\\\\033[0;31m'\nGREEN='\\\\033[0;32m'\nYELLOW='\\\\033[1;33m'\nNC='\\\\033[0m' # No Color\n\n# Test environment setup\nTEST_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" \u0026\u0026 pwd)\"\nHOOKS_DIR=\"$(dirname \"$TEST_DIR\")\"\nCONTEXT_DIR=\"$HOOKS_DIR/context\"\nORIG_LOG=\"\"\n\n# Test counters\nTESTS_RUN=0\nTESTS_PASSED=0\nTESTS_FAILED=0\n\n# Utility functions\nsetup_test() {\n    echo -e \"${YELLOW}Setting up test environment...${NC}\"\n    # Backup existing log\n    if [ -f \"$CONTEXT_DIR/edit-log.txt\" ]; then\n        ORIG_LOG=$(cat \"$CONTEXT_DIR/edit-log.txt\")\n    fi\n    \u003e \"$CONTEXT_DIR/edit-log.txt\"\n    export DEBUG_HOOKS=false\n}\n\nteardown_test() {\n    echo -e \"${YELLOW}Cleaning up test environment...${NC}\"\n    # Restore original log\n    if [ -n \"$ORIG_LOG\" ]; then\n        echo \"$ORIG_LOG\" \u003e \"$CONTEXT_DIR/edit-log.txt\"\n    else\n        \u003e \"$CONTEXT_DIR/edit-log.txt\"\n    fi\n}\n\nrun_test() {\n    local test_name=\"$1\"\n    local test_cmd=\"$2\"\n    local expected=\"$3\"\n    \n    TESTS_RUN=$((TESTS_RUN + 1))\n    echo -n \"Test $TESTS_RUN: $test_name... \"\n    \n    if eval \"$test_cmd\" 2\u003e/dev/null | grep -q \"$expected\" 2\u003e/dev/null; then\n        echo -e \"${GREEN}PASS${NC}\"\n        TESTS_PASSED=$((TESTS_PASSED + 1))\n    else\n        echo -e \"${RED}FAIL${NC}\"\n        echo \"  Expected: $expected\"\n        echo \"  Command: $test_cmd\"\n        TESTS_FAILED=$((TESTS_FAILED + 1))\n    fi\n}\n\n# Performance test utility\nmeasure_performance() {\n    local hook_name=\"$1\"\n    local test_input=\"$2\"\n    local hook_script=\"$3\"\n    \n    local start=$(date +%s%N)\n    echo \"$test_input\" | $hook_script \u003e /dev/null 2\u003e\u00261\n    local end=$(date +%s%N)\n    \n    local duration_ms=$(((end - start) / 1000000))\n    echo \"$duration_ms\"\n}\n\n# Main test execution\nmain() {\n    echo \"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\"\n    echo \"üß™ HOOKS INTEGRATION TEST SUITE\"\n    echo \"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\"\n    echo \"\"\n    \n    setup_test\n    \n    # Test 1: UserPromptSubmit - Skill activation\n    echo -e \"\\\\n${YELLOW}Testing UserPromptSubmit Hook...${NC}\"\n    \n    run_test \"TDD prompt activates skill\" \\\\\n        \"echo '{\\\"text\\\": \\\"I want to write a test for login\\\"}' | node $HOOKS_DIR/user-prompt-submit/10-skill-activator.js\" \\\\\n        \"test-driven-development\"\n    \n    run_test \"Empty prompt returns continue\" \\\\\n        \"echo '{\\\"text\\\": \\\"\\\"}' | node $HOOKS_DIR/user-prompt-submit/10-skill-activator.js\" \\\\\n        '{\"decision\":\"continue\"}'\n    \n    run_test \"Malformed JSON handled\" \\\\\n        \"echo 'not json' | node $HOOKS_DIR/user-prompt-submit/10-skill-activator.js\" \\\\\n        '{\"decision\":\"continue\"}'\n    \n    # Test 2: PostToolUse - Context tracking\n    echo -e \"\\\\n${YELLOW}Testing PostToolUse Hook...${NC}\"\n    \n    run_test \"Edit tool logs file\" \\\\\n        \"echo '{\\\"tool\\\": {\\\"name\\\": \\\"Edit\\\", \\\"input\\\": {\\\"file_path\\\": \\\"/test/file1.ts\\\"}}}' | bash $HOOKS_DIR/post-tool-use/01-track-edits.sh \u0026\u0026 tail -1 $CONTEXT_DIR/edit-log.txt\" \\\\\n        \"file1.ts\"\n    \n    run_test \"Write tool logs file\" \\\\\n        \"echo '{\\\"tool\\\": {\\\"name\\\": \\\"Write\\\", \\\"input\\\": {\\\"file_path\\\": \\\"/test/file2.py\\\"}}}' | bash $HOOKS_DIR/post-tool-use/01-track-edits.sh \u0026\u0026 tail -1 $CONTEXT_DIR/edit-log.txt\" \\\\\n        \"file2.py\"\n    \n    run_test \"Invalid tool ignored\" \\\\\n        \"echo '{\\\"tool\\\": {\\\"name\\\": \\\"Read\\\", \\\"input\\\": {\\\"file_path\\\": \\\"/test/file3.ts\\\"}}}' | bash $HOOKS_DIR/post-tool-use/01-track-edits.sh\" \\\\\n        '{\"decision\":\"continue\"}'\n    \n    # Test 3: Stop - Gentle reminders\n    echo -e \"\\\\n${YELLOW}Testing Stop Hook...${NC}\"\n    \n    # Add source file edit for TDD reminder\n    echo \"$(date +\"%Y-%m-%d %H:%M:%S\") | test | Edit | /src/main.ts\" \u003e\u003e \"$CONTEXT_DIR/edit-log.txt\"\n    \n    run_test \"TDD reminder shows\" \\\\\n        \"echo '{\\\"text\\\": \\\"Feature implemented\\\"}' | bash $HOOKS_DIR/stop/10-gentle-reminders.sh\" \\\\\n        \"TDD\"\n    \n    run_test \"Completion triggers verify\" \\\\\n        \"echo '{\\\"text\\\": \\\"All done and working!\\\"}' | bash $HOOKS_DIR/stop/10-gentle-reminders.sh\" \\\\\n        \"Run tests\"\n    \n    # Add multiple files for commit reminder\n    for i in {1..5}; do\n        echo \"$(date +\"%Y-%m-%d %H:%M:%S\") | test | Edit | /src/file$i.ts\" \u003e\u003e \"$CONTEXT_DIR/edit-log.txt\"\n    done\n    \n    run_test \"Many edits triggers commit\" \\\\\n        \"echo '{\\\"text\\\": \\\"Refactoring\\\"}' | bash $HOOKS_DIR/stop/10-gentle-reminders.sh\" \\\\\n        \"commit\"\n    \n    # Test 4: End-to-end workflow\n    echo -e \"\\\\n${YELLOW}Testing End-to-End Workflow...${NC}\"\n    \n    # Clear log for clean test\n    \u003e \"$CONTEXT_DIR/edit-log.txt\"\n    \n    # Simulate full workflow\n    echo \"Step 1: User prompt with TDD intent\"\n    result1=$(echo '{\"text\": \"I need to implement authentication with tests\"}' | \\\\\n              node \"$HOOKS_DIR/user-prompt-submit/10-skill-activator.js\")\n    \n    if echo \"$result1\" | grep -q \"test-driven-development\"; then\n        echo -e \"  ${GREEN}‚úì Skill activated${NC}\"\n    else\n        echo -e \"  ${RED}‚úó Skill not activated${NC}\"\n        TESTS_FAILED=$((TESTS_FAILED + 1))\n    fi\n    \n    echo \"Step 2: Edit files (triggers context tracking)\"\n    echo '{\"tool\": {\"name\": \"Edit\", \"input\": {\"file_path\": \"/src/auth.ts\"}}}' | \\\\\n        bash \"$HOOKS_DIR/post-tool-use/01-track-edits.sh\" \u003e /dev/null\n    \n    if grep -q \"auth.ts\" \"$CONTEXT_DIR/edit-log.txt\"; then\n        echo -e \"  ${GREEN}‚úì Edit tracked${NC}\"\n    else\n        echo -e \"  ${RED}‚úó Edit not tracked${NC}\"\n        TESTS_FAILED=$((TESTS_FAILED + 1))\n    fi\n    \n    echo \"Step 3: Response triggers reminder\"\n    result3=$(echo '{\"text\": \"Authentication implemented successfully!\"}' | \\\\\n              bash \"$HOOKS_DIR/stop/10-gentle-reminders.sh\")\n    \n    if echo \"$result3\" | grep -q \"TDD\\\\|test\"; then\n        echo -e \"  ${GREEN}‚úì Reminder shown${NC}\"\n    else\n        echo -e \"  ${RED}‚úó No reminder${NC}\"\n        TESTS_FAILED=$((TESTS_FAILED + 1))\n    fi\n    \n    # Test 5: Performance benchmarks\n    echo -e \"\\\\n${YELLOW}Performance Benchmarks...${NC}\"\n    \n    perf1=$(measure_performance \"UserPromptSubmit\" \\\\\n            '{\"text\": \"I want to write tests\"}' \\\\\n            \"node $HOOKS_DIR/user-prompt-submit/10-skill-activator.js\")\n    \n    perf2=$(measure_performance \"PostToolUse\" \\\\\n            '{\"tool\": {\"name\": \"Edit\", \"input\": {\"file_path\": \"/test.ts\"}}}' \\\\\n            \"bash $HOOKS_DIR/post-tool-use/01-track-edits.sh\")\n    \n    perf3=$(measure_performance \"Stop\" \\\\\n            '{\"text\": \"Done\"}' \\\\\n            \"bash $HOOKS_DIR/stop/10-gentle-reminders.sh\")\n    \n    echo \"UserPromptSubmit: ${perf1}ms (target: \u003c100ms)\"\n    echo \"PostToolUse: ${perf2}ms (target: \u003c10ms)\"\n    echo \"Stop: ${perf3}ms (target: \u003c50ms)\"\n    \n    # Check performance targets\n    if [ \"$perf1\" -lt 100 ] \u0026\u0026 [ \"$perf2\" -lt 10 ] \u0026\u0026 [ \"$perf3\" -lt 50 ]; then\n        echo -e \"${GREEN}‚úì All performance targets met${NC}\"\n        TESTS_PASSED=$((TESTS_PASSED + 1))\n    else\n        echo -e \"${RED}‚úó Performance targets not met${NC}\"\n        TESTS_FAILED=$((TESTS_FAILED + 1))\n    fi\n    \n    teardown_test\n    \n    # Summary\n    echo \"\"\n    echo \"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\"\n    echo \"üìä TEST RESULTS\"\n    echo \"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\"\n    echo \"Total: $TESTS_RUN\"\n    echo -e \"Passed: ${GREEN}$TESTS_PASSED${NC}\"\n    echo -e \"Failed: ${RED}$TESTS_FAILED${NC}\"\n    \n    if [ \"$TESTS_FAILED\" -eq 0 ]; then\n        echo -e \"\\\\n${GREEN}‚úÖ ALL TESTS PASSED!${NC}\"\n        exit 0\n    else\n        echo -e \"\\\\n${RED}‚ùå SOME TESTS FAILED${NC}\"\n        exit 1\n    fi\n}\n\n# Run tests\nmain\n\\`\\`\\`\n\n### Step 2: Make test executable and run\n\nRun:\n\\`\\`\\`bash\nchmod +x hooks/test/integration-test.sh\nbash hooks/test/integration-test.sh\n\\`\\`\\`\n\nExpected output:\n- All tests pass (green checkmarks)\n- Performance within targets\n- No errors or warnings\n\n### Step 3: Create error scenario tests\n\nCreate \\`hooks/test/error-test.sh\\`:\n\n\\`\\`\\`bash\n#!/bin/bash\nset -e\n\necho \"=== Testing Error Scenarios ===\"\n\n# Test 1: Missing skill-rules.json\necho \"Test 1: Missing skill-rules.json\"\nmv hooks/skill-rules.json hooks/skill-rules.json.bak 2\u003e/dev/null || true\nresult=$(echo '{\"text\": \"test\"}' | node hooks/user-prompt-submit/10-skill-activator.js 2\u003e/dev/null)\n[ \"$result\" = '{\"decision\":\"continue\"}' ] \u0026\u0026 echo \"‚úì Handled gracefully\" || echo \"‚úó Failed\"\nmv hooks/skill-rules.json.bak hooks/skill-rules.json 2\u003e/dev/null || true\n\n# Test 2: Corrupted edit-log.txt\necho \"Test 2: Corrupted log file\"\necho \"invalid|data|format\" \u003e hooks/context/edit-log.txt\nbash hooks/stop/10-gentle-reminders.sh \u003c/dev/null \u003e/dev/null 2\u003e\u00261 \u0026\u0026 echo \"‚úì Handled gracefully\" || echo \"‚úó Crashed\"\n\n# Test 3: Permission denied on log\necho \"Test 3: Permission denied\"\nchmod 000 hooks/context/edit-log.txt 2\u003e/dev/null || true\necho '{\"tool\": {\"name\": \"Edit\", \"input\": {\"file_path\": \"/test.ts\"}}}' | \\\\\n  bash hooks/post-tool-use/01-track-edits.sh \u003e/dev/null 2\u003e\u00261\n[ $? -eq 0 ] \u0026\u0026 echo \"‚úì Continued despite error\" || echo \"‚úó Failed\"\nchmod 644 hooks/context/edit-log.txt 2\u003e/dev/null || true\n\n# Test 4: Concurrent access\necho \"Test 4: Concurrent writes\"\nfor i in {1..10}; do\n    echo '{\"tool\": {\"name\": \"Edit\", \"input\": {\"file_path\": \"/test'$i'.ts\"}}}' | \\\\\n      bash hooks/post-tool-use/01-track-edits.sh \u0026\ndone\nwait\nlines=$(wc -l \u003c hooks/context/edit-log.txt)\n[ \"$lines\" -ge 8 ] \u0026\u0026 echo \"‚úì Most writes succeeded\" || echo \"‚úó Lost writes\"\n\necho \"=== Error Tests Complete ===\"\n\\`\\`\\`\n\n### Step 4: Run error tests\n\nRun:\n\\`\\`\\`bash\nchmod +x hooks/test/error-test.sh\nbash hooks/test/error-test.sh\n\\`\\`\\`\n\nExpected: All error scenarios handled gracefully\n\n### Step 5: Create performance stress test\n\nCreate \\`hooks/test/stress-test.sh\\`:\n\n\\`\\`\\`bash\n#!/bin/bash\necho \"=== Performance Stress Test ===\"\n\n# Test with very long prompt (10KB)\nlong_prompt=$(python3 -c \"print('test ' * 2000)\")\ntime echo \"{\\\"text\\\": \\\"$long_prompt\\\"}\" | node hooks/user-prompt-submit/10-skill-activator.js \u003e /dev/null\n\n# Test with 100 rapid edits\ntime for i in {1..100}; do\n    echo '{\"tool\": {\"name\": \"Edit\", \"input\": {\"file_path\": \"/test'$i'.ts\"}}}' | \\\\\n      bash hooks/post-tool-use/01-track-edits.sh\ndone\n\necho \"Stress test complete\"\n\\`\\`\\`\n\n### Step 6: Document test results\n\nCreate \\`hooks/test/TEST-RESULTS.md\\`:\n\n\\`\\`\\`markdown\n# Hook System Test Results\n\nDate: [Current Date]\nVersion: 1.0.0\n\n## Integration Tests\n- ‚úÖ 10/10 scenarios pass\n- ‚úÖ End-to-end workflow verified\n- ‚úÖ Performance targets met\n\n## Error Handling\n- ‚úÖ Missing files handled\n- ‚úÖ Corrupted data handled\n- ‚úÖ Permission errors handled\n- ‚úÖ Concurrent access safe\n\n## Performance\n| Hook | Target | Actual | Status |\n|------|--------|--------|--------|\n| UserPromptSubmit | \u003c100ms | XXms | ‚úÖ |\n| PostToolUse | \u003c10ms | XXms | ‚úÖ |\n| Stop | \u003c50ms | XXms | ‚úÖ |\n\n## Stress Test\n- 10KB prompt: XXXms\n- 100 rapid edits: XXXms total\n\\`\\`\\`\n\n### Step 7: Commit tests\n\nRun:\n\\`\\`\\`bash\ngit add hooks/test/*.sh hooks/test/TEST-RESULTS.md\ngit commit -m \"test(bd-8): comprehensive integration tests\n\nImplements bd-8: Integration Testing\n- End-to-end workflow tests\n- Error scenario handling\n- Performance benchmarks\n- Stress testing\n- All tests passing\"\n\\`\\`\\`\n\n## Key Considerations (ADDED BY SRE REVIEW)\n\n**Test Coverage**:\n- Happy path (normal operation)\n- Error cases (missing files, bad data)\n- Edge cases (empty input, huge input)\n- Concurrent access\n- Performance under load\n\n**Test Isolation**:\n- Save/restore original state\n- Clean environment for each test\n- No side effects between tests\n\n**Realistic Scenarios**:\n- Test actual user workflows\n- Include timing/performance checks\n- Verify hook interaction\n\n**Maintenance**:\n- Tests must be repeatable\n- Clear failure messages\n- Easy to add new test cases\n\n## Anti-patterns\n- ‚ùå Only testing happy path\n- ‚ùå Tests that depend on external state\n- ‚ùå No performance validation\n- ‚ùå Unclear failure messages\n- ‚ùå Tests that can't be run repeatedly","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-30T13:57:03.330003-04:00","updated_at":"2025-10-30T15:43:58.539522-04:00","closed_at":"2025-10-30T15:43:58.539522-04:00","dependencies":[{"issue_id":"bd-8","depends_on_id":"bd-1","type":"parent-child","created_at":"2025-10-30T13:57:10.547958-04:00","created_by":"ryan"},{"issue_id":"bd-8","depends_on_id":"bd-7","type":"blocks","created_at":"2025-10-30T13:57:16.875377-04:00","created_by":"ryan"}]}
{"id":"bd-8y0","title":"Implement ralph-runner YOLO mode with ralphex feature parity","description":"## Summary\n\nImplemented ralph-runner autonomous epic executor for OpenCode with full ralphex feature parity.\n\n## Components Created\n\n### OpenCode Primary Agent\n- `ralph-runner.md` - YOLO mode agent with all permissions auto-approved\n- Default agent in opencode.json\n- Uses smart triage (bv -robot-triage, bv -robot-next, bv -robot-plan)\n\n### 5 Review Agents (both platforms)\n- `review-quality` - bugs, security, race conditions\n- `review-implementation` - requirements verification  \n- `review-testing` - test coverage and quality\n- `review-simplification` - over-engineering detection\n- `review-documentation` - docs update needs\n\n### Updated execute-ralph Skill\n- Smart triage integration (bv robot-* commands)\n- Git branch creation from epic name\n- Auto-commit after each task\n- 5-agent parallel review per task\n- 2-agent critical-only final review\n\n## Feature Comparison with ralphex\n\n| Feature | ralphex | execute-ralph |\n|---------|---------|---------------|\n| Multi-agent review | ‚úÖ | ‚úÖ |\n| Git branch | ‚úÖ | ‚úÖ |\n| Auto-commit | ‚úÖ | ‚úÖ |\n| Final review | ‚úÖ 2 agents | ‚úÖ 2 agents |\n| Smart triage | ‚ùå | ‚úÖ |\n| bd integration | ‚ùå | ‚úÖ |\n\n## Testing\n\n- Verified in OpenCode with `opencode run`\n- All 5 review agents load as subagents\n- Smart triage working correctly\n- Skills load on both Claude Code and OpenCode","status":"closed","priority":2,"issue_type":"feature","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T11:19:56.026649247+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T11:20:01.896881312+02:00","closed_at":"2026-02-01T11:20:01.896881312+02:00","close_reason":"Completed - all features implemented and tested"}
{"id":"bd-9","title":"Bug: Hooks using invalid 'continue' decision instead of 'approve' or 'deny'","design":"## Root Cause Analysis\n\nThe hooks implementation used 'continue' as a decision value, which was incorrect. The fix changed it to 'approve', but that's ALSO incorrect!\n\nAccording to Claude Code official documentation:\n\n**Valid decision values by hook type:**\n- **PreToolUse**: 'allow', 'deny', 'ask'\n- **PostToolUse, UserPromptSubmit, Stop, SubagentStop**: 'block' OR undefined (no decision field)\n- **SessionStart/SessionEnd**: No decision field; use additionalContext only\n\n**Our hooks and their issues:**\n\n1. **SessionStart hook** (hooks/session-start.sh:25-32)\n   - ‚úÖ CORRECT: Returns hookSpecificOutput with additionalContext, no decision field\n   \n2. **Stop hook** (hooks/stop/10-gentle-reminders.sh:85-86)\n   - ‚úÖ CORRECT: Returns nothing (just exit 0), which is valid for non-blocking reminders\n   \n3. **PostToolUse hook** (hooks/post-tool-use/01-track-edits.sh:73,79,98,119)\n   - ‚ùå INCORRECT: Returns {\"decision\": \"approve\"} \n   - Should: Omit decision field entirely (just tracking edits, not blocking)\n   - Correct format: {} or {\"hookSpecificOutput\": {\"hookEventName\": \"PostToolUse\"}}\n   \n4. **UserPromptSubmit hook** (hooks/user-prompt-submit/10-skill-activator.js:159,167,182,190,197)\n   - ‚ùå INCORRECT: Returns {\"decision\": \"approve\", \"additionalContext\": \"...\"}\n   - Should: Omit decision field (adding context, not blocking prompts)\n   - Correct format: {\"additionalContext\": \"...\"} or {\"hookSpecificOutput\": {\"hookEventName\": \"UserPromptSubmit\", \"additionalContext\": \"...\"}}\n\n**Why 'approve' is wrong:**\n- 'approve' is a deprecated legacy value that mapped to 'allow' for PreToolUse\n- For PostToolUse and UserPromptSubmit, 'approve' is not a valid decision\n- These hooks should either omit the decision field OR use 'block' if they want to halt execution\n\n**Evidence:**\n- Official docs: https://docs.claude.com/en/docs/claude-code/hooks\n- Research from hyperpowers:internet-researcher agent (detailed analysis)\n- Git history shows 'continue' was changed to 'approve' in 6aaceca, but both are incorrect\n\n## Solution Approach\n\n1. Remove decision field from PostToolUse hook (4 locations in hooks/post-tool-use/01-track-edits.sh)\n2. Remove decision field from UserPromptSubmit hook (5 locations in hooks/user-prompt-submit/10-skill-activator.js)  \n3. Update all documentation/examples to reflect correct response structure\n4. Keep SessionStart and Stop hooks as-is (already correct)","notes":"## Summary\n\nFixed hooks to use correct decision values per Claude Code specification.\n\n## Changes Made\n\n### 1. PostToolUse Hook (hooks/post-tool-use/01-track-edits.sh)\n- Removed invalid 'decision': 'approve' field (4 locations)\n- Now returns '{}' (empty object) - correct for non-blocking logging hooks\n\n### 2. UserPromptSubmit Hook (hooks/user-prompt-submit/10-skill-activator.js)\n- Removed invalid 'decision': 'approve' field (5 locations)\n- Now returns '{}' or '{\"additionalContext\": \"...\"}' - correct for context injection\n\n### 3. Test Files Updated\n- hooks/post-tool-use/test-hook.sh: Check for no decision field\n- hooks/user-prompt-submit/test-hook.sh: Check for no decision field\n- hooks/test/integration-test.sh: Updated expectations\n\n### 4. Documentation Updated\n- HOOKS.md: Updated output examples\n- skills/building-hooks/resources/hook-examples.md: Fixed all examples\n- skills/building-hooks/resources/hook-patterns.md: Fixed all patterns\n- skills/skills-auto-activation/resources/hook-implementation.md: Fixed expected output\n\n## Verification\n\nAll integration tests passing (13/13).","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-10-30T16:08:29.942365-04:00","updated_at":"2025-10-30T16:16:30.423079-04:00","closed_at":"2025-10-30T16:16:30.423079-04:00"}
{"id":"bd-aum","title":"Create INSTALL-KIMI.md documentation","description":"Create .kimi/INSTALL.md with installation and usage documentation.\n\nSections:\n1. Prerequisites (Kimi CLI installed, Python/uv)\n2. Quick install (run script)\n3. Manual install steps\n4. What gets installed (skills, agents, main agent)\n5. Usage (/skill:name invocations)\n6. Flow skills (how to invoke with /flow:name)\n7. Subagents (how Task tool dispatches)\n8. Customization (override skills, add your own)\n9. Development (--symlink mode)\n10. Troubleshooting\n\n## Acceptance Criteria\n- [ ] Clear installation instructions\n- [ ] All features documented\n- [ ] Examples for common operations\n- [ ] Troubleshooting section","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:28:27.406358444+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T21:24:49.092452107+02:00","closed_at":"2026-02-01T21:24:49.092452107+02:00","close_reason":"Created comprehensive INSTALL.md with 332 lines covering all installation, usage, and troubleshooting topics","dependencies":[{"issue_id":"bd-aum","depends_on_id":"bd-t7f","type":"blocks","created_at":"2026-02-01T20:31:06.990490848+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-aum","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:16.549209022+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-czt","title":"Task 1: Migrate OpenCode bundle and add beads-triage","description":"## Goal\nMigrate `.opencode` directories to plural names, add the `beads-triage` skill/command, and update installation docs for the OpenCode bundle.\n\n## Effort Estimate\n- 6 hours (360 min) including migration, docs, and verification.\n\n## Success Criteria\n- [ ] Only plural directories exist: `.opencode/commands`, `.opencode/agents`, `.opencode/plugins`, `.opencode/skills` (no `.opencode/command`, `.opencode/agent`, `.opencode/plugin`).\n- [ ] Files exist at `.opencode/skills/beads-triage/SKILL.md` and `.opencode/commands/beads-triage.md`, and `.opencode/INSTALL.md` documents bundle layout and `/beads-triage` usage.\n- [ ] `beads-triage` skill content explicitly runs `bv --robot-triage`, installs `bv` if missing, passes through optional args, and returns raw JSON only.\n- [ ] Pre-commit hooks pass.\n\n## Implementation Checklist\n- [ ] `git mv .opencode/command .opencode/commands`, `git mv .opencode/agent .opencode/agents`, `git mv .opencode/plugin .opencode/plugins`.\n- [ ] Update references to singular paths in `.opencode/plugins/hyperpowers-skills.ts`, `.opencode/INSTALL.md`, and any `.opencode/commands/*.md` or `.opencode/agents/*.md` that mention old paths.\n- [ ] Add `.opencode/skills/beads-triage/SKILL.md` describing: run `bv --robot-triage` directly, auto-install when missing, pass-through args, and output raw JSON only.\n- [ ] Add `.opencode/commands/beads-triage.md` with a `template:` that invokes the skill and forwards `$ARGUMENTS`.\n- [ ] Update `.opencode/INSTALL.md` with plural bundle layout, plugin symlink instructions, `bv` auto-install note, and `/beads-triage` usage example.\n\n## Key Considerations / Edge Cases\n- `bv` missing: ensure the install script runs before retrying triage, and failures surface clearly.\n- Optional args (label/track/etc.) must be passed through without alteration or reordering.\n- Skill output must be raw JSON only; no extra prose or summaries.\n- OpenCode auto-discovery requires plural directories and no lingering singular directories.\n\n## Anti-Patterns (Forbidden)\n- ‚ùå Running bare `bv` or any interactive TUI entry point.\n- ‚ùå TODOs, placeholders, or stub skill/command content.\n- ‚ùå Summarizing triage output instead of returning raw JSON.\n- ‚ùå Keeping or reintroducing singular `.opencode/command`, `.opencode/agent`, `.opencode/plugin` directories.\n\n## Test/Verification Expectations\n- Prefer meaningful verification over trivial checks. At minimum:\n  - `ls .opencode` confirms only plural directories.\n  - `rg \"\\.opencode/(command|agent|plugin)\"` finds zero matches.\n  - `rg \"bv --robot-triage\" .opencode/skills/beads-triage/SKILL.md` confirms direct invocation.\n  - `rg \"\\$ARGUMENTS\" .opencode/commands/beads-triage.md` confirms argument passthrough.\n- If automated tests exist for OpenCode bundles, add or update a test that asserts the command template includes `$ARGUMENTS` and the skill mandates raw JSON output. Avoid snapshot-only or existence-only tests.","status":"closed","priority":2,"issue_type":"feature","owner":"dmitry.polishuk@gmail.com","estimated_minutes":360,"created_at":"2026-01-20T14:06:09.821091+03:00","created_by":"Dmitry Polishuk","updated_at":"2026-01-20T14:22:07.584168+03:00","closed_at":"2026-01-20T14:22:07.584168+03:00","close_reason":"Completed migration to plural .opencode directories, added beads-triage skill/command, updated install docs.","dependencies":[{"issue_id":"bd-czt","depends_on_id":"bd-4j3","type":"parent-child","created_at":"2026-01-20T14:06:12.453683+03:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-eg9","title":"Task 1: Align plugin metadata + docs for myhyperpowers","design":"## Goal\nAlign Claude Code plugin metadata and documentation to the new `myhyperpowers` name, matching marketplace requirements and local dev workflow.\n\n## Effort Estimate\n2-3 hours.\n\n## Implementation\n1. Review existing metadata and docs\n   - `.claude-plugin/plugin.json`\n   - `.claude-plugin/marketplace.json`\n   - `README.md` Claude Code install section\n   - `CLAUDE.md` Publishing section\n\n2. Update plugin metadata\n   - Set `name` to `myhyperpowers`\n   - Add component paths: `commands`, `agents`, `skills`, `hooks`, `mcpServers`\n\n3. Update marketplace metadata\n   - Set top-level `name` to `myhyperpowers`\n   - Set plugin entry `name` to `myhyperpowers`\n   - Sync `version` to 2.6.0 and keep `source: \"./\"`\n\n4. Update docs\n   - README: add `claude --plugin-dir .` local dev instructions\n   - README: update marketplace install/update commands to `myhyperpowers@myhyperpowers`\n   - README: add migration note for legacy installs\n   - CLAUDE.md: update publishing snippet to `myhyperpowers`\n\n## Implementation Checklist\n- [ ] `.claude-plugin/plugin.json` - rename to `myhyperpowers` and add component paths\n- [ ] `.claude-plugin/plugin.json` - include `mcpServers: \"./.mcp.json\"` (and confirm file exists)\n- [ ] `.claude-plugin/marketplace.json` - update marketplace + plugin entry names, sync version\n- [ ] `README.md` - update Claude Code install/update/uninstall commands + migration note\n- [ ] `CLAUDE.md` - update publishing snippet to `myhyperpowers`\n\n## Success Criteria\n- [ ] `.claude-plugin/plugin.json` contains `name: \"myhyperpowers\"` and paths for `commands`, `agents`, `skills`, `hooks`, `mcpServers`\n- [ ] `.claude-plugin/marketplace.json` top-level `name` and plugin `name` are `myhyperpowers`, with `version: \"2.6.0\"` and `source: \"./\"`\n- [ ] `README.md` includes `claude --plugin-dir .` and `/plugin install myhyperpowers@myhyperpowers`\n- [ ] `CLAUDE.md` Publishing section references `myhyperpowers`\n- [ ] README includes a legacy uninstall note for previous names\n\n## Key Considerations (ADDED BY SRE REVIEW)\n- **Path safety:** all plugin.json paths must be relative and inside repo root (no `../`).\n- **MCP config:** only add `mcpServers` if `.mcp.json` exists (it does in this repo).\n- **Marketplace consistency:** plugin + marketplace names must match or install commands break.\n- **Docs accuracy:** ensure scope flags (`--scope user|project|local`) are documented exactly as in Claude Code docs.\n\n## Anti-Patterns\n- ‚ùå NO changes to skill/agent content (scope is metadata/docs only).\n- ‚ùå NO new build steps or version bumps beyond syncing to 2.6.0.\n- ‚ùå NO absolute paths or path traversal in plugin.json.","status":"closed","priority":2,"issue_type":"feature","owner":"dmitry.polishuk@gmail.com","created_at":"2026-01-22T15:33:31.5889+03:00","created_by":"Dmitry Polishuk","updated_at":"2026-01-22T15:43:01.825125+03:00","closed_at":"2026-01-22T15:43:01.825125+03:00","close_reason":"Closed","dependencies":[{"issue_id":"bd-eg9","depends_on_id":"bd-jdc","type":"parent-child","created_at":"2026-01-22T15:33:35.091496+03:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-j8k","title":"Task 1: Add cass memory injection scaffolding","design":"## Goal\nDeliver OpenCode plugin + Claude Code hook scaffolding that injects cass context on every agent call with deterministic formatting and logging.\n\n## Effort Estimate\n6-8 hours\n\n## Success Criteria\n- [ ] Task tool prompt contains a \"Cass Memory\" block when `cm context` returns rules.\n- [ ] Top-level prompt contains the same \"Cass Memory\" block via the Claude Code hook.\n- [ ] Formatter unit tests cover: empty context, truncation behavior, ordering by relevance, and invalid JSON handling.\n- [ ] Missing/failed `cm` execution logs to `.opencode/cache/cass/errors.log` and does not block execution.\n- [ ] Config defaults load successfully and overrides are honored.\n- [ ] Tests pass (`node --test` or existing test runner).\n- [ ] Pre-commit hooks pass.\n\n## Implementation Checklist\n1. Study existing patterns\n   - `.opencode/plugins/hyperpowers-skills.ts` (plugin shape)\n   - `.opencode/plugins/hyperpowers-safety.ts` (`tool.execute.before` usage)\n   - `hooks/user-prompt-submit/10-skill-activator.js` (additionalContext injection)\n\n2. Tests first (TDD)\n   - Identify existing test runner (package.json scripts).\n   - If no runner exists, add a `node:test` file at `tests/cass-memory.test.js` and run with `node --test`.\n   - Tests must assert deterministic formatting, truncation marker presence, empty input, and invalid JSON fallback.\n\n3. Formatting + config\n   - Add a formatter function (file path decided during implementation) that takes parsed cass JSON + limits and returns the prompt block.\n   - Add `.opencode/cass-memory.json` defaults: `enabled`, `timeoutMs`, `maxRules`, `maxWarnings`, `maxChars`, `logLevel`.\n\n4. OpenCode plugin\n   - Create `.opencode/plugins/cass-memory.ts`.\n   - In `tool.execute.before`, detect `task`, call `cm context \"\u003cprompt\u003e\" --json`, parse, format, and prepend to `output.args.prompt`.\n   - On error/timeout, append to `.opencode/cache/cass/errors.log` and skip injection.\n\n5. Claude Code hook\n   - Create `hooks/user-prompt-submit/20-cass-context.js`.\n   - Run `cm context \"\u003cprompt\u003e\" --json`, parse/format, and return `additionalContext`.\n   - Write last response to `hooks/context/cass-context.json` for debugging.\n\n6. Manual verification\n   - Run `cm context \"smoke test\" --json` to confirm parsing.\n   - Trigger a Task tool invocation and confirm the \"Cass Memory\" block appears in the agent prompt.\n\n## Key Considerations (ADDED BY SRE REVIEW)\n- **Edge case: `cm` missing or non-zero exit** ‚Üí Skip injection, log error, do not fail.\n- **Edge case: invalid JSON output** ‚Üí Catch parse errors, log, and proceed without memory.\n- **Edge case: very large context** ‚Üí Enforce `maxChars` and add a clear \"(truncated)\" marker.\n- **Concurrency: multiple agents writing logs** ‚Üí Use append-only logs with timestamps to avoid clobbering.\n- **Security: prompt may contain secrets** ‚Üí Pass only the prompt text, avoid adding env/config values to logs.\n\n## Anti-Patterns\n- ‚ùå NO hard failure when `cm` is missing or times out (must degrade gracefully).\n- ‚ùå NO injection into non-agent tools (limit to Task + top-level prompt).\n- ‚ùå NO unbounded memory payloads (must enforce size limits).\n- ‚ùå NO tautological tests (e.g., ‚Äúformatter returns string‚Äù).\n- ‚ùå NO TODOs without issue numbers.","status":"closed","priority":2,"issue_type":"feature","owner":"dmitry.polishuk@gmail.com","created_at":"2026-01-21T23:11:20.751667+03:00","created_by":"Dmitry Polishuk","updated_at":"2026-01-22T11:31:21.836562+03:00","closed_at":"2026-01-22T11:31:21.836562+03:00","close_reason":"Closed","dependencies":[{"issue_id":"bd-j8k","depends_on_id":"bd-3yf","type":"parent-child","created_at":"2026-01-21T23:11:23.597657+03:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-jdc","title":"Feature: Align Claude Code plugin + marketplace (myhyperpowers)","design":"## Requirements (IMMUTABLE)\n- `.claude-plugin/plugin.json` uses name `myhyperpowers` and declares component paths for `commands`, `agents`, `skills`, `hooks`, and `mcpServers` (pointing to `./.mcp.json`).\n- `.claude-plugin/marketplace.json` uses name `myhyperpowers` and the plugin entry name `myhyperpowers`, with version matching `plugin.json` (2.6.0) and `source: \"./\"`.\n- `README.md` and `CLAUDE.md` include Claude Code local dev instructions (`claude --plugin-dir .`) and marketplace install/update/uninstall commands using `myhyperpowers`.\n- A migration note explains how to uninstall legacy names and reinstall `myhyperpowers@myhyperpowers`.\n\n## Success Criteria (MUST ALL BE TRUE)\n- [ ] `.claude-plugin/plugin.json` includes component paths and `name: myhyperpowers`.\n- [ ] `.claude-plugin/marketplace.json` name + plugin entry name are `myhyperpowers` and version is 2.6.0.\n- [ ] `README.md` Claude Code section shows `claude --plugin-dir .` and `myhyperpowers@myhyperpowers` commands.\n- [ ] `CLAUDE.md` Publishing section references `myhyperpowers` install location and version tracking.\n- [ ] Migration note for legacy installs is present.\n\n## Anti-Patterns (FORBIDDEN)\n- ‚ùå NO runtime behavior changes to skills/agents/hooks (reason: scope is metadata/docs only).\n- ‚ùå NO moving directories or renaming repo paths (reason: keep existing clone paths stable).\n- ‚ùå NO mismatched names between plugin.json and marketplace.json (reason: breaks install commands).\n\n## Approach\nUpdate plugin metadata to match Claude Code‚Äôs official plugin schema, explicitly referencing component directories at repo root. Align marketplace metadata to the same name and version, and update documentation to reflect the new plugin name and local development flags. Provide a short migration note for users of legacy names.\n\n## Architecture\n- `.claude-plugin/plugin.json` adds component paths + name change.\n- `.claude-plugin/marketplace.json` aligns marketplace name and version.\n- `README.md` and `CLAUDE.md` document local dev + marketplace install/update/uninstall.\n\n## Design Rationale\n### Problem\nCurrent metadata and docs are inconsistent with Claude Code plugin requirements, causing confusing install commands and marketplace version drift. The repo needs explicit component paths and consistent naming.\n\n### Research Findings\n**Codebase:**\n- `.claude-plugin/plugin.json` only includes basic metadata (missing component paths).\n- `.claude-plugin/marketplace.json` uses legacy name/version.\n- `README.md` + `CLAUDE.md` reference old marketplace install commands.\n\n**External:**\n- Claude Code plugin docs require `.claude-plugin/plugin.json` with component paths and relative roots: https://code.claude.com/docs/en/plugins\n- Marketplace docs describe marketplace.json schema and install commands: https://code.claude.com/docs/en/plugin-marketplaces\n- Plugin reference documents `/plugin install` scopes and update commands: https://code.claude.com/docs/en/plugins-reference\n\n### Approaches Considered\n1. **Rename to myhyperpowers + align metadata/docs** ‚úì\n   - Pros: consistent naming, matches user requirement, reduces install confusion\n   - Cons: requires migration note for legacy installs\n   - **Chosen because:** user explicitly requested rename and consistency\n\n2. **Keep hyperpowers name and just sync metadata**\n   - Pros: avoids rename\n   - Cons: violates user requirement\n   - **Rejected because:** user asked to rename to myhyperpowers\n\n3. **Keep legacy withzombies-hyper marketplace name**\n   - Pros: avoids reinstall for existing users\n   - Cons: continues confusion with plugin.json name\n   - **Rejected because:** user wants unified rename\n\n### Scope Boundaries\n**In scope:** metadata alignment, docs updates, migration note\n**Out of scope (deferred/never):** renaming GitHub repo or restructuring plugin contents\n\n### Open Questions\n- Should the GitHub repo or marketplace repo name eventually change to match `myhyperpowers`?","status":"closed","priority":2,"issue_type":"epic","owner":"dmitry.polishuk@gmail.com","created_at":"2026-01-22T15:33:09.961231+03:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-04T16:42:51.694639261+02:00","closed_at":"2026-02-04T16:42:51.694639261+02:00","close_reason":"Closed"}
{"id":"bd-mx7","title":"Convert agents to Kimi YAML format","description":"Convert all OpenCode/Claude agents to Kimi CLI YAML format.\n\nAgents to convert:\n1. codebase-investigator\n2. code-reviewer\n3. test-effectiveness-analyst\n4. internet-researcher\n5. autonomous-reviewer\n6. test-runner\n\nKimi agent YAML format:\n```yaml\nversion: 1\nagent:\n  name: codebase-investigator\n  extend: default\n  system_prompt_path: ./system.md\n  tools:\n    - \"kimi_cli.tools.file:ReadFile\"\n    - \"kimi_cli.tools.shell:Shell\"\n  exclude_tools:\n    - \"kimi_cli.tools.file:WriteFile\"\n    - \"kimi_cli.tools.file:StrReplaceFile\"\n```\n\nEach agent needs:\n- YAML config file (.yaml)\n- System prompt file (.md)\n- Proper tool restrictions\n\n## Acceptance Criteria\n- [ ] 6 agent YAML files in .kimi/agents/\n- [ ] Each has corresponding system.md prompt\n- [ ] Tools properly configured per agent role\n- [ ] Read-only agents exclude write tools","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:27:59.501074851+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T20:55:44.109390903+02:00","closed_at":"2026-02-01T20:55:44.109390903+02:00","close_reason":"Created 6 Kimi YAML agents with system prompts: codebase-investigator, code-reviewer, test-effectiveness-analyst, internet-researcher, autonomous-reviewer, test-runner","dependencies":[{"issue_id":"bd-mx7","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:15.901154084+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-n1c","title":"Copy all skills to .kimi/skills/","description":"Copy all 21 existing skills from skills/ to .kimi/skills/.\n\nSkills to copy:\n1. analyzing-test-effectiveness\n2. brainstorming\n3. building-hooks\n4. debugging-with-tools\n5. dispatching-parallel-agents\n6. execute-ralph\n7. executing-plans\n8. finishing-a-development-branch\n9. fixing-bugs\n10. managing-bd-tasks\n11. refactoring-safely\n12. review-implementation\n13. root-cause-tracing\n14. skills-auto-activation\n15. sre-task-refinement\n16. test-driven-development\n17. testing-anti-patterns\n18. using-hyper\n19. verification-before-completion\n20. writing-plans\n21. writing-skills\n\nThe SKILL.md format is already compatible with Kimi CLI.\n\n## Acceptance Criteria\n- [ ] All 21 skills copied to .kimi/skills/\n- [ ] Each skill has SKILL.md file\n- [ ] Frontmatter valid (name, description)","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:27:14.084407003+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T20:35:18.034746127+02:00","closed_at":"2026-02-01T20:35:18.034746127+02:00","close_reason":"Copied 21 skills to .kimi/skills/, all with valid SKILL.md frontmatter","dependencies":[{"issue_id":"bd-n1c","depends_on_id":"bd-14c","type":"blocks","created_at":"2026-02-01T20:31:04.290522475+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-n1c","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:14.774833739+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-o7a","title":"Add Kimi CLI support to hyperpowers","description":"## Overview\nAdd full native Kimi CLI support to the hyperpowers plugin, leveraging Kimi's unique features like Flow skills, YAML agents, and built-in tools.\n\n## Requirements\n\n### Directory Structure\n- `.kimi/` - Primary Kimi-native directory\n- `.kimi/skills/` - SKILL.md files\n- `.kimi/agents/` - YAML agent files  \n- `.kimi/mcp.json` - MCP server config\n- `.kimi/hyperpowers.yaml` - Main agent with all subagents\n- `.agents/skills/` - Symlink to .kimi/skills/ for cross-platform compatibility\n\n### Skills (21 total)\n- Copy all existing skills to `.kimi/skills/`\n- Convert applicable skills to Flow format with Mermaid diagrams:\n  - execute-ralph (autonomous loop)\n  - test-driven-development (RED/GREEN/REFACTOR)\n  - fixing-bugs (discovery‚Üítest‚Üífix‚Üíverify)\n  - executing-plans (task‚Üíreview‚Üínext)\n  - brainstorming (Q\u0026A branches)\n  - All other applicable workflows\n\n### Agents (YAML format)\nConvert all agents to Kimi YAML format, both standalone and subagent:\n- codebase-investigator: ReadFile, Shell\n- code-reviewer: ReadFile, exclude WriteFile\n- test-effectiveness-analyst: ReadFile, Shell\n- internet-researcher: SearchWeb, FetchURL\n- autonomous-reviewer: All review tools\n- test-runner: Shell, SetTodoList\n\n### Kimi-Native Tool Integration\n- SetTodoList for in-session task tracking\n- StrReplaceFile as primary edit tool\n- CreateSubagent for dynamic agent spawning (Ralph)\n\n### Install Script\nCreate scripts/install-kimi-plugin.sh with:\n- Copy/symlink skills to ~/.config/agents/skills/\n- Copy/symlink agents to ~/.config/agents/\n- Create main hyperpowers.yaml with all subagents\n- Backup existing installation\n- Version tracking\n- Dev mode with --symlink\n- MCP config merge\n- Dependency installation\n- Validation checks\n\n### Commands\nAll commands become /skill:name invocations:\n- /skill:brainstorm\n- /skill:write-plan\n- /skill:execute-ralph\n- etc.\n\n## Success Criteria\n- [ ] .kimi/ directory structure created\n- [ ] All 21 skills copied and working\n- [ ] Flow skills with Mermaid diagrams for key workflows\n- [ ] All agents converted to YAML format\n- [ ] hyperpowers.yaml with all subagents defined\n- [ ] Install script working with all features\n- [ ] .agents/skills symlink for compatibility\n- [ ] Documentation updated","status":"closed","priority":1,"issue_type":"epic","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:27:01.881486712+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T21:25:09.025626179+02:00","closed_at":"2026-02-01T21:25:09.025626179+02:00","close_reason":"All 12 tasks completed: .kimi/ structure, 21 skills, 5 Flow skills, 6 YAML agents, main agent, install script, MCP config, and documentation"}
{"id":"bd-pkc","title":"Task 2: Verify cass injection paths","design":"## Goal\nAdd automated verification that both the OpenCode plugin and Claude Code hook inject the cass memory block when `cm` returns rules, and that error paths remain non-blocking.\n\n## Context\nTask bd-j8k implemented the integration but only manual smoke checks were run. This task adds runnable tests to prove injection behavior and log handling for the epic success criteria.\n\n## Effort Estimate\n4-6 hours\n\n## Success Criteria\n- [ ] `bun test tests/cass-memory-plugin.test.ts` passes with tests:\n  - `injects_cass_block_for_task_prompt`\n  - `skips_injection_on_cm_failure`\n  - `skips_injection_on_success_false`\n- [ ] `node --test tests/cass-memory-hook.test.js` passes with tests:\n  - `hook_injects_additional_context`\n  - `hook_returns_empty_on_cm_failure`\n- [ ] Plugin test uses a temp repo root and leaves no files in `.opencode/cache`.\n- [ ] Hook test removes `hooks/context/cass-errors.log` and `hooks/context/cass-context.json` after execution.\n- [ ] Existing formatter tests still pass (`node --test tests/cass-memory.test.js`).\n\n## Implementation Checklist\n1. Plugin injection tests\n   - Create `tests/cass-memory-plugin.test.ts`.\n   - Build a temp directory with `.opencode/cass-memory.json` enabled and point `ctx.directory` at it.\n   - Stub `ctx.$` template-tag to return `{ text: async () =\u003e json, exited: Promise.resolve(0) }`.\n   - Assert prompt prepends `Cass Memory (rules)` and preserves original prompt.\n   - Add failure tests for `exited !== 0` and `success: false` JSON.\n\n2. Hook injection tests\n   - Create `tests/cass-memory-hook.test.js`.\n   - Generate a temp `cm` stub executable that prints JSON with `data.relevantBullets`.\n   - Run `node hooks/user-prompt-submit/20-cass-context.js` with PATH pointing to the stub.\n   - Assert stdout JSON contains `additionalContext` with the Cass block.\n   - Add a failure case stub that exits non-zero and assert stdout is `{}`.\n   - Remove any `hooks/context/cass-errors.log` and `hooks/context/cass-context.json` created during the test.\n\n3. Verification\n   - Run `node --test tests/cass-memory.test.js`.\n   - Run `bun test tests/cass-memory-plugin.test.ts`.\n   - Run `node --test tests/cass-memory-hook.test.js`.\n\n## Key Considerations (ADDED BY SRE REVIEW)\n- **Edge case: `cm` returns `{ success: false }`** ‚Üí plugin/hook must skip injection and log.\n- **Edge case: invalid JSON output** ‚Üí test should cover parse failures and skip injection.\n- **Edge case: temp PATH pollution** ‚Üí restore PATH after hook tests.\n- **Concurrency:** log files must be cleaned even if test fails (use `try/finally`).\n- **Isolation:** plugin tests should write only to temp directories, not repo.\n\n## Anti-Patterns\n- ‚ùå NO relying on real `cm` binary in tests (must stub for determinism).\n- ‚ùå NO leaving test artifacts in `hooks/context` or `.opencode/cache`.\n- ‚ùå NO skipping error-path coverage (`exitCode != 0`, `success: false`, invalid JSON).\n- ‚ùå NO tests that only assert string existence without verifying prompt placement.\n- ‚ùå NO TODOs without issue numbers.","status":"closed","priority":2,"issue_type":"feature","owner":"dmitry.polishuk@gmail.com","created_at":"2026-01-22T11:36:56.950207+03:00","created_by":"Dmitry Polishuk","updated_at":"2026-01-22T11:52:14.704592+03:00","closed_at":"2026-01-22T11:52:14.704592+03:00","close_reason":"Closed","dependencies":[{"issue_id":"bd-pkc","depends_on_id":"bd-3yf","type":"parent-child","created_at":"2026-01-22T11:37:02.853819+03:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-t7f","title":"Create install-kimi-plugin.sh script","description":"Create scripts/install-kimi-plugin.sh with full feature set.\n\nFeatures:\n1. Copy/symlink skills to ~/.config/agents/skills/\n2. Copy/symlink agents to ~/.config/agents/\n3. Copy hyperpowers.yaml to ~/.config/agents/\n4. Backup existing installation\n5. Version tracking (read from plugin.json)\n6. Dev mode with --symlink flag\n7. MCP config merge (add to ~/.config/kimi/mcp.json)\n8. Validation checks (kimi installed, correct version)\n\nScript structure:\n```bash\n#!/usr/bin/env bash\nset -euo pipefail\n\n# Colors and helpers (like other install scripts)\n# Parse args (--symlink for dev mode)\n# Check prerequisites (kimi command exists)\n# Backup existing installation\n# Create directories\n# Copy/symlink skills\n# Copy/symlink agents\n# Copy hyperpowers.yaml\n# Merge MCP config if exists\n# Print success message with next steps\n```\n\n## Acceptance Criteria\n- [ ] Script executable and working\n- [ ] --symlink flag for dev mode\n- [ ] Backup before overwriting\n- [ ] Version displayed on install\n- [ ] MCP config merged (not overwritten)\n- [ ] Validation checks pass/fail gracefully","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:28:19.311761354+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T21:21:43.293332703+02:00","closed_at":"2026-02-01T21:21:43.293332703+02:00","close_reason":"Created install-kimi-plugin.sh with all features: copy/symlink, backup, version tracking, MCP merge, validation","dependencies":[{"issue_id":"bd-t7f","depends_on_id":"bd-14c","type":"blocks","created_at":"2026-02-01T20:31:05.849867805+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-t7f","depends_on_id":"bd-n1c","type":"blocks","created_at":"2026-02-01T20:31:06.213370415+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-t7f","depends_on_id":"bd-mx7","type":"blocks","created_at":"2026-02-01T20:31:06.455579916+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-t7f","depends_on_id":"bd-yl2","type":"blocks","created_at":"2026-02-01T20:31:06.649300467+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-t7f","depends_on_id":"bd-wha","type":"blocks","created_at":"2026-02-01T20:31:06.865987948+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-t7f","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:16.226961485+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-wha","title":"Create MCP config for hyperpowers","description":"Create .kimi/mcp.json with hyperpowers MCP servers.\n\nConsider including:\n- context7 for documentation lookup\n- Any custom MCP servers hyperpowers needs\n\n```json\n{\n  \"mcpServers\": {\n    \"context7\": {\n      \"url\": \"https://mcp.context7.com/mcp\",\n      \"headers\": {\n        \"CONTEXT7_API_KEY\": \"\\${CONTEXT7_API_KEY}\"\n      }\n    }\n  }\n}\n```\n\nThe install script should merge this with user's existing mcp.json.\n\n## Acceptance Criteria\n- [ ] .kimi/mcp.json created\n- [ ] Valid JSON format\n- [ ] Environment variable placeholders for API keys\n- [ ] Install script merges (not overwrites) user config","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:28:23.186830041+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T21:18:35.377957976+02:00","closed_at":"2026-02-01T21:18:35.377957976+02:00","close_reason":"Created .kimi/mcp.json with context7 MCP server and env var placeholder","dependencies":[{"issue_id":"bd-wha","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:16.36356678+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-xhp","title":"Convert execute-ralph to Flow skill with Mermaid","description":"Convert execute-ralph skill to Kimi CLI Flow format.\n\nFlow skills require:\n- `type: flow` in frontmatter\n- Mermaid diagram with BEGIN and END nodes\n- Decision nodes output `\u003cchoice\u003ebranch\u003c/choice\u003e` syntax\n\nExample structure:\n```yaml\n---\nname: execute-ralph\ndescription: Execute entire bd epic autonomously\ntype: flow\n---\n```\n\n```mermaid\nflowchart TD\n    BEGIN[Start Ralph] --\u003e LOAD[Load Epic from bd]\n    LOAD --\u003e CHECK{Tasks remaining?}\n    CHECK --\u003e|Yes| EXECUTE[Execute next task]\n    EXECUTE --\u003e REVIEW[Run 5 parallel reviewers]\n    REVIEW --\u003e CRITICAL[Final critical review]\n    CRITICAL --\u003e PASS{Review passed?}\n    PASS --\u003e|Yes| COMMIT[Auto-commit]\n    COMMIT --\u003e CHECK\n    PASS --\u003e|No| FIX[Address issues]\n    FIX --\u003e REVIEW\n    CHECK --\u003e|No| END[Complete]\n```\n\n## Acceptance Criteria\n- [ ] type: flow in frontmatter\n- [ ] Valid Mermaid flowchart\n- [ ] BEGIN and END nodes present\n- [ ] Decision nodes with proper branching\n- [ ] Autonomous execution loop captured","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:27:20.287379949+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T20:39:52.517609431+02:00","closed_at":"2026-02-01T20:39:52.517609431+02:00","close_reason":"Converted to Flow skill with Mermaid flowchart","dependencies":[{"issue_id":"bd-xhp","depends_on_id":"bd-n1c","type":"blocks","created_at":"2026-02-01T20:31:04.445215901+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-xhp","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:14.954353809+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"bd-yl2","title":"Create hyperpowers.yaml main agent with subagents","description":"Create the main hyperpowers.yaml agent that includes all agents as subagents.\n\n```yaml\nversion: 1\nagent:\n  name: hyperpowers\n  extend: default\n  system_prompt_path: ./system.md\n  tools:\n    - \"kimi_cli.tools.multiagent:Task\"\n    - \"kimi_cli.tools.multiagent:CreateSubagent\"\n    - \"kimi_cli.tools.shell:Shell\"\n    - \"kimi_cli.tools.file:ReadFile\"\n    - \"kimi_cli.tools.file:WriteFile\"\n    - \"kimi_cli.tools.file:StrReplaceFile\"\n    - \"kimi_cli.tools.web:SearchWeb\"\n    - \"kimi_cli.tools.web:FetchURL\"\n    - \"kimi_cli.tools.todo:SetTodoList\"\n  subagents:\n    codebase-investigator:\n      path: ./agents/codebase-investigator.yaml\n      description: \"Explores repo to verify patterns and file locations\"\n    code-reviewer:\n      path: ./agents/code-reviewer.yaml\n      description: \"Reviews implementations against plans\"\n    test-effectiveness-analyst:\n      path: ./agents/test-effectiveness-analyst.yaml\n      description: \"Audits test quality with SRE scrutiny\"\n    internet-researcher:\n      path: ./agents/internet-researcher.yaml\n      description: \"Researches APIs, libraries, documentation\"\n    autonomous-reviewer:\n      path: ./agents/autonomous-reviewer.yaml\n      description: \"Ralph's autonomous code reviewer\"\n    test-runner:\n      path: ./agents/test-runner.yaml\n      description: \"Runs tests, returns only failures\"\n```\n\n## Acceptance Criteria\n- [ ] hyperpowers.yaml in .kimi/\n- [ ] All 6 subagents defined\n- [ ] Kimi-native tools enabled (SetTodoList, StrReplaceFile, CreateSubagent)\n- [ ] System prompt references skills","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-01T20:28:07.328716166+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-01T20:57:34.476101469+02:00","closed_at":"2026-02-01T20:57:34.476101469+02:00","close_reason":"Created hyperpowers.yaml with 6 subagents and hyperpowers-system.md with skill references","dependencies":[{"issue_id":"bd-yl2","depends_on_id":"bd-mx7","type":"blocks","created_at":"2026-02-01T20:31:05.600920839+02:00","created_by":"Dmitry Polishuk"},{"issue_id":"bd-yl2","depends_on_id":"bd-o7a","type":"parent-child","created_at":"2026-02-01T20:31:16.04825759+02:00","created_by":"Dmitry Polishuk"}]}
